<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=Generator content="Microsoft Word 11 (filtered)">
<title>Basics of SPE Programming</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 5 4 2 2 2 2 2 4;}
@font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;}
@font-face
	{font-family:"Tms Rmn";
	panose-1:2 2 6 3 4 5 5 2 3 4;}
@font-face
	{font-family:Helv;
	panose-1:2 11 6 4 2 2 2 3 2 4;}
@font-face
	{font-family:"New York";
	panose-1:2 4 5 3 6 5 6 2 3 4;}
@font-face
	{font-family:System;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"ＭＳ 明朝";
	panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
	{font-family:Batang;
	panose-1:2 3 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:PMingLiU;
	panose-1:2 2 3 0 0 0 0 0 0 0;}
@font-face
	{font-family:"ＭＳ ゴシック";
	panose-1:2 11 6 9 7 2 5 8 2 4;}
@font-face
	{font-family:Dotum;
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:SimHei;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:MingLiU;
	panose-1:2 2 3 9 0 0 0 0 0 0;}
@font-face
	{font-family:Mincho;
	panose-1:2 2 6 9 4 3 5 8 3 5;}
@font-face
	{font-family:Gulim;
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:Century;
	panose-1:2 4 6 4 5 5 5 2 3 4;}
@font-face
	{font-family:"Angsana New";
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:"Cordia New";
	panose-1:2 11 3 4 2 2 2 2 2 4;}
@font-face
	{font-family:Mangal;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Latha;
	panose-1:2 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Sylfaen;
	panose-1:1 10 5 2 5 3 6 3 3 3;}
@font-face
	{font-family:Vrinda;
	panose-1:1 1 6 0 1 1 1 1 1 1;}
@font-face
	{font-family:Raavi;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Shruti;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Sendnya;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Gautami;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Tunga;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Estrangelo Edessa";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Kartika;
	panose-1:2 2 5 3 3 4 4 6 2 3;}
@font-face
	{font-family:"Arial Unicode MS";
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:"MS UI Gothic";
	panose-1:2 11 6 0 7 2 5 8 2 4;}
@font-face
	{font-family:"ＭＳ Ｐゴシック";
	panose-1:2 11 6 0 7 2 5 8 2 4;}
@font-face
	{font-family:Marlett;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Lucida Console";
	panose-1:2 11 6 9 4 5 4 2 2 4;}
@font-face
	{font-family:"Lucida Sans Unicode";
	panose-1:2 11 6 2 3 5 4 2 2 4;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"Arial Black";
	panose-1:2 11 10 4 2 1 2 2 2 4;}
@font-face
	{font-family:"Comic Sans MS";
	panose-1:3 15 7 2 3 3 2 2 2 4;}
@font-face
	{font-family:Impact;
	panose-1:2 11 8 6 3 9 2 5 2 4;}
@font-face
	{font-family:Georgia;
	panose-1:2 4 5 2 5 4 5 2 3 3;}
@font-face
	{font-family:"Franklin Gothic Medium";
	panose-1:2 11 6 3 2 1 2 2 2 4;}
@font-face
	{font-family:"Palatino Linotype";
	panose-1:2 4 5 2 5 5 5 3 3 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"Trebuchet MS";
	panose-1:2 11 6 3 2 2 2 2 2 4;}
@font-face
	{font-family:Webdings;
	panose-1:5 3 1 2 1 5 9 6 7 3;}
@font-face
	{font-family:"MV Boli";}
@font-face
	{font-family:"¥@ＭＳ ゴシック";
	panose-1:2 11 6 9 7 2 5 8 2 4;}
@font-face
	{font-family:"¥@ＭＳ Ｐゴシック";
	panose-1:2 11 6 0 7 2 5 8 2 4;}
@font-face
	{font-family:"¥@MS UI Gothic";
	panose-1:2 11 6 0 7 2 5 8 2 4;}
@font-face
	{font-family:"¥@ＭＳ 明朝";
	panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
	{font-family:"ＭＳ Ｐ明朝";
	panose-1:2 2 6 0 4 2 5 8 3 4;}
@font-face
	{font-family:"¥@ＭＳ Ｐ明朝";
	panose-1:2 2 6 0 4 2 5 8 3 4;}
@font-face
	{font-family:"Microsoft Sans Serif";
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:"¥@Gulim";
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:GulimChe;
	panose-1:2 11 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:"¥@GulimChe";
	panose-1:2 11 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:"¥@Dotum";
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:DotumChe;
	panose-1:2 11 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:"¥@DotumChe";
	panose-1:2 11 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:"¥@Batang";
	panose-1:2 3 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:BatangChe;
	panose-1:2 3 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:"¥@BatangChe";
	panose-1:2 3 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:Gungsuh;
	panose-1:2 3 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:"¥@Gungsuh";
	panose-1:2 3 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:GungsuhChe;
	panose-1:2 3 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:"¥@GungsuhChe";
	panose-1:2 3 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:"¥@SimSun";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:NSimSun;
	panose-1:2 1 6 9 3 1 1 1 1 1;}
@font-face
	{font-family:"¥@NSimSun";
	panose-1:2 1 6 9 3 1 1 1 1 1;}
@font-face
	{font-family:"¥@SimHei";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"¥@MingLiU";
	panose-1:2 2 3 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@PMingLiU";
	panose-1:2 2 3 0 0 0 0 0 0 0;}
@font-face
	{font-family:BrushScrD;
	panose-1:3 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:NimbusSanT;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:NimbusSanTCon;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:NimbusRomNo9T;
	panose-1:1 1 1 3 1 1 1 1 1 1;}
@font-face
	{font-family:"Nimbus Script";
	panose-1:3 1 1 1 1 1 1 1 1 1;}
@font-face
	{font-family:TBｺﾞｼｯｸB;
	panose-1:2 11 7 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@TBｺﾞｼｯｸB";
	panose-1:2 11 7 9 0 0 0 0 0 0;}
@font-face
	{font-family:TBPｺﾞｼｯｸB;
	panose-1:2 11 7 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@TBPｺﾞｼｯｸB";
	panose-1:2 11 7 0 0 0 0 0 0 0;}
@font-face
	{font-family:TBｺﾞｼｯｸR;
	panose-1:2 11 4 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@TBｺﾞｼｯｸR";
	panose-1:2 11 4 9 0 0 0 0 0 0;}
@font-face
	{font-family:TBPｺﾞｼｯｸR;
	panose-1:2 11 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@TBPｺﾞｼｯｸR";
	panose-1:2 11 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:TB丸ｺﾞｼｯｸDE;
	panose-1:2 15 7 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@TB丸ｺﾞｼｯｸDE";
	panose-1:2 15 7 9 0 0 0 0 0 0;}
@font-face
	{font-family:TBP丸ｺﾞｼｯｸDE;
	panose-1:2 15 7 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@TBP丸ｺﾞｼｯｸDE";
	panose-1:2 15 7 0 0 0 0 0 0 0;}
@font-face
	{font-family:TB丸ｺﾞｼｯｸR;
	panose-1:2 15 4 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@TB丸ｺﾞｼｯｸR";
	panose-1:2 15 4 9 0 0 0 0 0 0;}
@font-face
	{font-family:TBP丸ｺﾞｼｯｸR;
	panose-1:2 15 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@TBP丸ｺﾞｼｯｸR";
	panose-1:2 15 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Agency FB";
	panose-1:2 11 5 3 2 2 2 2 2 4;}
@font-face
	{font-family:Algerian;
	panose-1:4 2 7 5 4 10 2 6 7 2;}
@font-face
	{font-family:"Arial Rounded MT Bold";
	panose-1:2 15 7 4 3 5 4 3 2 4;}
@font-face
	{font-family:"Baskerville Old Face";
	panose-1:2 2 6 2 8 5 5 2 3 3;}
@font-face
	{font-family:"Bauhaus 93";
	panose-1:4 3 9 5 2 11 2 2 12 2;}
@font-face
	{font-family:"Bell MT";
	panose-1:2 2 5 3 6 3 5 2 3 3;}
@font-face
	{font-family:"Berlin Sans FB";
	panose-1:2 14 6 2 2 5 2 2 3 6;}
@font-face
	{font-family:"Bernard MT Condensed";
	panose-1:2 5 8 6 6 9 5 2 4 4;}
@font-face
	{font-family:"Blackadder ITC";
	panose-1:4 2 5 5 5 16 7 2 13 2;}
@font-face
	{font-family:"Bodoni MT";
	panose-1:2 7 6 3 8 6 6 2 2 3;}
@font-face
	{font-family:"Bodoni MT Black";
	panose-1:2 7 10 3 8 6 6 2 2 3;}
@font-face
	{font-family:"Bodoni MT Condensed";
	panose-1:2 7 6 6 8 6 6 2 2 3;}
@font-face
	{font-family:"Bodoni MT Poster Compressed";
	panose-1:2 7 7 6 8 6 1 5 2 4;}
@font-face
	{font-family:"Book Antiqua";
	panose-1:2 4 6 2 5 3 5 3 3 4;}
@font-face
	{font-family:"Bookman Old Style";
	panose-1:2 5 6 4 5 5 5 2 2 4;}
@font-face
	{font-family:"Bradley Hand ITC";
	panose-1:3 7 4 2 5 3 2 3 2 3;}
@font-face
	{font-family:"Britannic Bold";
	panose-1:2 11 9 3 6 7 3 2 2 4;}
@font-face
	{font-family:Broadway;
	panose-1:4 4 9 5 8 11 2 2 5 2;}
@font-face
	{font-family:"Brush Script MT";
	panose-1:3 6 8 2 4 4 6 7 3 4;}
@font-face
	{font-family:"Californian FB";
	panose-1:2 7 4 3 6 8 11 3 2 4;}
@font-face
	{font-family:"Calisto MT";
	panose-1:2 4 6 3 5 5 5 3 3 4;}
@font-face
	{font-family:Castellar;
	panose-1:2 10 4 2 6 4 6 1 3 1;}
@font-face
	{font-family:Centaur;
	panose-1:2 3 5 4 5 2 5 2 3 4;}
@font-face
	{font-family:"Century Gothic";
	panose-1:2 11 5 2 2 2 2 2 2 4;}
@font-face
	{font-family:"Century Schoolbook";
	panose-1:2 4 6 4 5 5 5 2 3 4;}
@font-face
	{font-family:Chiller;
	panose-1:4 2 4 4 3 16 7 2 6 2;}
@font-face
	{font-family:"Colonna MT";
	panose-1:4 2 8 5 6 2 2 3 2 3;}
@font-face
	{font-family:"Cooper Black";
	panose-1:2 8 9 4 4 3 11 2 4 4;}
@font-face
	{font-family:"Copperplate Gothic Bold";
	panose-1:2 14 7 5 2 2 6 2 4 4;}
@font-face
	{font-family:"Copperplate Gothic Light";
	panose-1:2 14 5 7 2 2 6 2 4 4;}
@font-face
	{font-family:"Curlz MT";
	panose-1:4 4 4 4 5 7 2 2 2 2;}
@font-face
	{font-family:"Edwardian Script ITC";
	panose-1:3 3 3 2 4 7 7 13 8 4;}
@font-face
	{font-family:Elephant;
	panose-1:2 2 9 4 9 5 5 2 3 3;}
@font-face
	{font-family:"Engravers MT";
	panose-1:2 9 7 7 8 5 5 2 3 4;}
@font-face
	{font-family:"Eras Bold ITC";
	panose-1:2 11 9 7 3 5 4 2 2 4;}
@font-face
	{font-family:"Eras Demi ITC";
	panose-1:2 11 8 5 3 5 4 2 8 4;}
@font-face
	{font-family:"Eras Light ITC";
	panose-1:2 11 4 2 3 5 4 2 8 4;}
@font-face
	{font-family:"Eras Medium ITC";
	panose-1:2 11 6 2 3 5 4 2 8 4;}
@font-face
	{font-family:"Felix Titling";
	panose-1:4 6 5 5 6 2 2 2 10 4;}
@font-face
	{font-family:"Footlight MT Light";
	panose-1:2 4 6 2 6 3 10 2 3 4;}
@font-face
	{font-family:Forte;
	panose-1:3 6 9 2 4 5 2 7 2 3;}
@font-face
	{font-family:"Franklin Gothic Book";
	panose-1:2 11 5 3 2 1 2 2 2 4;}
@font-face
	{font-family:"Franklin Gothic Demi";
	panose-1:2 11 7 3 2 1 2 2 2 4;}
@font-face
	{font-family:"Franklin Gothic Demi Cond";
	panose-1:2 11 7 6 3 4 2 2 2 4;}
@font-face
	{font-family:"Franklin Gothic Heavy";
	panose-1:2 11 9 3 2 1 2 2 2 4;}
@font-face
	{font-family:"Franklin Gothic Medium Cond";
	panose-1:2 11 6 6 3 4 2 2 2 4;}
@font-face
	{font-family:"Freestyle Script";
	panose-1:3 8 4 2 3 2 5 11 4 4;}
@font-face
	{font-family:"French Script MT";
	panose-1:3 2 4 2 4 6 7 4 6 5;}
@font-face
	{font-family:Garamond;
	panose-1:2 2 4 4 3 3 1 1 8 3;}
@font-face
	{font-family:Gigi;
	panose-1:4 4 5 4 6 16 7 2 13 2;}
@font-face
	{font-family:"Gill Sans MT Ext Condensed Bold";
	panose-1:2 11 9 2 2 1 4 2 2 3;}
@font-face
	{font-family:"Gill Sans MT";
	panose-1:2 11 5 2 2 1 4 2 2 3;}
@font-face
	{font-family:"Gill Sans MT Condensed";
	panose-1:2 11 5 6 2 1 4 2 2 3;}
@font-face
	{font-family:"Gill Sans Ultra Bold";
	panose-1:2 11 10 2 2 1 4 2 2 3;}
@font-face
	{font-family:"Gill Sans Ultra Bold Condensed";
	panose-1:2 11 10 6 2 1 4 2 2 3;}
@font-face
	{font-family:"Gloucester MT Extra Condensed";
	panose-1:2 3 8 8 2 6 1 1 1 1;}
@font-face
	{font-family:"Goudy Old Style";
	panose-1:2 2 5 2 5 3 5 2 3 3;}
@font-face
	{font-family:"Goudy Stout";
	panose-1:2 2 9 4 7 3 11 2 4 1;}
@font-face
	{font-family:Haettenschweiler;
	panose-1:2 11 7 6 4 9 2 6 2 4;}
@font-face
	{font-family:"Harlow Solid Italic";
	panose-1:4 3 6 4 2 15 2 2 13 2;}
@font-face
	{font-family:Harrington;
	panose-1:4 4 5 5 5 10 2 2 7 2;}
@font-face
	{font-family:"High Tower Text";
	panose-1:2 4 5 2 5 5 6 3 3 3;}
@font-face
	{font-family:"Imprint MT Shadow";
	panose-1:4 2 6 5 6 3 3 3 2 2;}
@font-face
	{font-family:Jokerman;
	panose-1:4 9 6 5 6 13 6 2 7 2;}
@font-face
	{font-family:"Juice ITC";
	panose-1:4 4 4 3 4 10 2 2 2 2;}
@font-face
	{font-family:"Kristen ITC";
	panose-1:3 5 5 2 4 2 2 3 2 2;}
@font-face
	{font-family:"Kunstler Script";
	panose-1:3 3 4 2 2 6 7 13 13 6;}
@font-face
	{font-family:"Lucida Bright";
	panose-1:2 4 6 2 5 5 5 2 3 4;}
@font-face
	{font-family:"Lucida Calligraphy";
	panose-1:3 1 1 1 1 1 1 1 1 1;}
@font-face
	{font-family:"Lucida Fax";
	panose-1:2 6 6 2 5 5 5 2 2 4;}
@font-face
	{font-family:"Lucida Handwriting";
	panose-1:3 1 1 1 1 1 1 1 1 1;}
@font-face
	{font-family:"Lucida Sans";
	panose-1:2 11 6 2 3 5 4 2 2 4;}
@font-face
	{font-family:"Lucida Sans Typewriter";
	panose-1:2 11 5 9 3 5 4 3 2 4;}
@font-face
	{font-family:"MS Outlook";
	panose-1:5 1 1 0 1 0 0 0 0 0;}
@font-face
	{font-family:Magneto;
	panose-1:4 3 8 5 5 8 2 2 13 2;}
@font-face
	{font-family:"Maiandra GD";
	panose-1:2 14 5 2 3 3 8 2 2 4;}
@font-face
	{font-family:"Matura MT Script Capitals";
	panose-1:3 2 8 2 6 6 2 7 2 2;}
@font-face
	{font-family:Mistral;
	panose-1:3 9 7 2 3 4 7 2 4 3;}
@font-face
	{font-family:"Modern No¥. 20";
	panose-1:2 7 7 4 7 5 5 2 3 3;}
@font-face
	{font-family:"Monotype Corsiva";
	panose-1:3 1 1 1 1 2 1 1 1 1;}
@font-face
	{font-family:"Niagara Engraved";
	panose-1:4 2 5 2 7 7 3 3 2 2;}
@font-face
	{font-family:"Niagara Solid";
	panose-1:4 2 5 2 7 7 2 2 2 2;}
@font-face
	{font-family:"OCR A Extended";
	panose-1:2 1 5 9 2 1 2 1 3 3;}
@font-face
	{font-family:"Old English Text MT";
	panose-1:3 4 9 2 4 5 8 3 8 6;}
@font-face
	{font-family:Onyx;
	panose-1:4 5 6 2 8 7 2 2 2 3;}
@font-face
	{font-family:"Palace Script MT";
	panose-1:3 3 3 2 2 6 7 12 11 5;}
@font-face
	{font-family:Papyrus;
	panose-1:3 7 5 2 6 5 2 3 2 5;}
@font-face
	{font-family:Parchment;
	panose-1:3 4 6 2 4 7 8 4 8 4;}
@font-face
	{font-family:Perpetua;
	panose-1:2 2 5 2 6 4 1 2 3 3;}
@font-face
	{font-family:"Perpetua Titling MT";
	panose-1:2 2 5 2 6 5 5 2 8 4;}
@font-face
	{font-family:Playbill;
	panose-1:4 5 6 3 10 6 2 2 2 2;}
@font-face
	{font-family:"Poor Richard";
	panose-1:2 8 5 2 5 5 5 2 7 2;}
@font-face
	{font-family:Pristina;
	panose-1:3 6 4 2 4 4 6 8 2 4;}
@font-face
	{font-family:"Rage Italic";
	panose-1:3 7 5 2 4 5 7 7 3 4;}
@font-face
	{font-family:Ravie;
	panose-1:4 4 8 5 5 8 9 2 6 2;}
@font-face
	{font-family:Rockwell;
	panose-1:2 6 6 3 2 2 5 2 4 3;}
@font-face
	{font-family:"Rockwell Condensed";
	panose-1:2 6 6 3 5 4 5 2 1 4;}
@font-face
	{font-family:"Rockwell Extra Bold";
	panose-1:2 6 9 3 4 5 5 2 4 3;}
@font-face
	{font-family:"Informal Roman";
	panose-1:3 6 4 2 3 4 6 11 2 4;}
@font-face
	{font-family:"Script MT Bold";
	panose-1:3 4 6 2 4 6 7 8 9 4;}
@font-face
	{font-family:"Showcard Gothic";
	panose-1:4 2 9 4 2 1 2 2 6 4;}
@font-face
	{font-family:"Snap ITC";
	panose-1:4 4 10 7 6 10 2 2 2 2;}
@font-face
	{font-family:Stencil;
	panose-1:4 4 9 5 13 8 2 2 4 4;}
@font-face
	{font-family:"Tw Cen MT";
	panose-1:2 11 6 2 2 1 4 2 6 3;}
@font-face
	{font-family:"Tw Cen MT Condensed";
	panose-1:2 11 6 6 2 1 4 2 2 3;}
@font-face
	{font-family:"Tempus Sans ITC";
	panose-1:4 2 4 4 3 13 7 2 2 2;}
@font-face
	{font-family:"Viner Hand ITC";
	panose-1:3 7 5 2 3 5 2 2 2 3;}
@font-face
	{font-family:Vivaldi;
	panose-1:3 2 6 2 5 5 6 9 8 4;}
@font-face
	{font-family:"Vladimir Script";
	panose-1:3 5 4 2 4 4 7 7 3 5;}
@font-face
	{font-family:"Wide Latin";
	panose-1:2 10 10 7 5 5 5 2 4 4;}
@font-face
	{font-family:"Wingdings 2";
	panose-1:5 2 1 2 1 5 7 7 7 7;}
@font-face
	{font-family:"Wingdings 3";
	panose-1:5 4 1 2 1 8 7 7 7 7;}
@font-face
	{font-family:HGｺﾞｼｯｸE;
	panose-1:2 11 9 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGｺﾞｼｯｸE";
	panose-1:2 11 9 9 0 0 0 0 0 0;}
@font-face
	{font-family:HGPｺﾞｼｯｸE;
	panose-1:2 11 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGPｺﾞｼｯｸE";
	panose-1:2 11 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:HGSｺﾞｼｯｸE;
	panose-1:2 11 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGSｺﾞｼｯｸE";
	panose-1:2 11 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:HGｺﾞｼｯｸM;
	panose-1:2 11 6 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGｺﾞｼｯｸM";
	panose-1:2 11 6 9 0 0 0 0 0 0;}
@font-face
	{font-family:HGPｺﾞｼｯｸM;
	panose-1:2 11 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGPｺﾞｼｯｸM";
	panose-1:2 11 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:HGSｺﾞｼｯｸM;
	panose-1:2 11 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGSｺﾞｼｯｸM";
	panose-1:2 11 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:HG行書体;
	panose-1:3 0 6 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HG行書体";
	panose-1:3 0 6 9 0 0 0 0 0 0;}
@font-face
	{font-family:HGP行書体;
	panose-1:3 0 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGP行書体";
	panose-1:3 0 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:HGS行書体;
	panose-1:3 0 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGS行書体";
	panose-1:3 0 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:HG教科書体;
	panose-1:2 2 6 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HG教科書体";
	panose-1:2 2 6 9 0 0 0 0 0 0;}
@font-face
	{font-family:HGP教科書体;
	panose-1:2 2 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGP教科書体";
	panose-1:2 2 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:HGS教科書体;
	panose-1:2 2 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGS教科書体";
	panose-1:2 2 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:HG丸ｺﾞｼｯｸM-PRO;
	panose-1:2 15 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HG丸ｺﾞｼｯｸM-PRO";
	panose-1:2 15 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:HG明朝B;
	panose-1:2 2 8 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HG明朝B";
	panose-1:2 2 8 9 0 0 0 0 0 0;}
@font-face
	{font-family:HGP明朝B;
	panose-1:2 2 8 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGP明朝B";
	panose-1:2 2 8 0 0 0 0 0 0 0;}
@font-face
	{font-family:HGS明朝B;
	panose-1:2 2 8 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGS明朝B";
	panose-1:2 2 8 0 0 0 0 0 0 0;}
@font-face
	{font-family:HG明朝E;
	panose-1:2 2 9 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HG明朝E";
	panose-1:2 2 9 9 0 0 0 0 0 0;}
@font-face
	{font-family:HGP明朝E;
	panose-1:2 2 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGP明朝E";
	panose-1:2 2 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:HGS明朝E;
	panose-1:2 2 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGS明朝E";
	panose-1:2 2 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:HG創英角ｺﾞｼｯｸUB;
	panose-1:2 11 9 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HG創英角ｺﾞｼｯｸUB";
	panose-1:2 11 9 9 0 0 0 0 0 0;}
@font-face
	{font-family:HGP創英角ｺﾞｼｯｸUB;
	panose-1:2 11 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGP創英角ｺﾞｼｯｸUB";
	panose-1:2 11 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:HGS創英角ｺﾞｼｯｸUB;
	panose-1:2 11 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGS創英角ｺﾞｼｯｸUB";
	panose-1:2 11 9 0 0 0 0 0 0 0;}
@font-face
	{font-family:HG創英角ﾎﾟｯﾌﾟ体;
	panose-1:4 11 10 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HG創英角ﾎﾟｯﾌﾟ体";
	panose-1:4 11 10 9 0 0 0 0 0 0;}
@font-face
	{font-family:HGP創英角ﾎﾟｯﾌﾟ体;
	panose-1:4 11 10 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGP創英角ﾎﾟｯﾌﾟ体";
	panose-1:4 11 10 0 0 0 0 0 0 0;}
@font-face
	{font-family:HGS創英角ﾎﾟｯﾌﾟ体;
	panose-1:4 11 10 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGS創英角ﾎﾟｯﾌﾟ体";
	panose-1:4 11 10 0 0 0 0 0 0 0;}
@font-face
	{font-family:HG創英ﾌﾟﾚｾﾞﾝｽEB;
	panose-1:2 2 8 9 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HG創英ﾌﾟﾚｾﾞﾝｽEB";
	panose-1:2 2 8 9 0 0 0 0 0 0;}
@font-face
	{font-family:HGP創英ﾌﾟﾚｾﾞﾝｽEB;
	panose-1:2 2 8 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGP創英ﾌﾟﾚｾﾞﾝｽEB";
	panose-1:2 2 8 0 0 0 0 0 0 0;}
@font-face
	{font-family:HGS創英ﾌﾟﾚｾﾞﾝｽEB;
	panose-1:2 2 8 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HGS創英ﾌﾟﾚｾﾞﾝｽEB";
	panose-1:2 2 8 0 0 0 0 0 0 0;}
@font-face
	{font-family:HG正楷書体-PRO;
	panose-1:3 0 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@HG正楷書体-PRO";
	panose-1:3 0 6 0 0 0 0 0 0 0;}
@font-face
	{font-family:OCRB;
	panose-1:2 11 6 9 2 2 2 2 2 4;}
@font-face
	{font-family:"Berlin Sans FB Demi";
	panose-1:2 14 8 2 2 5 2 2 3 6;}
@font-face
	{font-family:"Bookshelf Symbol 7";
	panose-1:5 1 1 1 1 1 1 1 1 1;}
@font-face
	{font-family:"MS Reference Sans Serif";
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"MS Reference Specialty";
	panose-1:5 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Tw Cen MT Condensed Extra Bold";
	panose-1:2 11 8 3 2 2 2 2 2 4;}
@font-face
	{font-family:"MT Extra";
	panose-1:5 5 1 2 1 2 5 2 2 2;}
@font-face
	{font-family:"Myriad Condensed Web";
	panose-1:2 11 5 6 3 4 3 2 2 4;}
@font-face
	{font-family:"Myriad Web";
	panose-1:2 11 5 3 3 4 3 2 2 4;}
@font-face
	{font-family:"Tera Special";
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Bitstream Vera Sans";
	panose-1:2 11 6 3 3 8 4 2 2 4;}
@font-face
	{font-family:"Bitstream Vera Serif";
	panose-1:2 6 6 3 5 6 5 2 2 4;}
@font-face
	{font-family:"Bitstream Vera Sans Mono";
	panose-1:2 11 6 9 3 8 4 2 2 4;}
@font-face
	{font-family:OpenSymbol;
	panose-1:5 1 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Arial Narrow";
	panose-1:2 11 5 6 2 2 2 3 2 4;}
@font-face
	{font-family:"MS 明朝";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:CourierNewPS-ItalicMT;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"EHJAP H+ Helvetica";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"¥@EHJAP H+ Helvetica";}
@font-face
	{font-family:"¥@MS 明朝";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0mm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:Century;}
h1
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:21.25pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-21.25pt;
	page-break-after:avoid;
	font-size:12.0pt;
	font-family:Arial;
	font-weight:bold;}
h2
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:49.6pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-10.0mm;
	page-break-after:avoid;
	font-size:10.5pt;
	font-family:Arial;
	font-weight:normal;}
h3
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:70.9pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-10.0mm;
	page-break-after:avoid;
	font-size:10.5pt;
	font-family:Arial;
	font-weight:normal;}
h4
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:99.2pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-35.4pt;
	page-break-after:avoid;
	font-size:10.5pt;
	font-family:Century;
	font-weight:bold;}
h5
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:127.55pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-42.5pt;
	page-break-after:avoid;
	font-size:10.5pt;
	font-family:Arial;
	font-weight:normal;}
h6
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:163.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-20.0mm;
	page-break-after:avoid;
	font-size:10.5pt;
	font-family:Century;
	font-weight:bold;}
p.MsoHeading7, li.MsoHeading7, div.MsoHeading7
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:191.35pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-63.8pt;
	page-break-after:avoid;
	font-size:10.5pt;
	font-family:Century;}
p.MsoHeading8, li.MsoHeading8, div.MsoHeading8
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:219.7pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-70.9pt;
	page-break-after:avoid;
	font-size:10.5pt;
	font-family:Century;}
p.MsoHeading9, li.MsoHeading9, div.MsoHeading9
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:255.1pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:-85.0pt;
	page-break-after:avoid;
	font-size:10.5pt;
	font-family:Century;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin:0mm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:Century;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:10.5pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:Century;}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{margin:0mm;
	margin-bottom:.0001pt;
	font-size:10.5pt;
	font-family:Century;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{margin:0mm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	layout-grid-mode:char;
	font-size:10.5pt;
	font-family:Century;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{margin:0mm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	layout-grid-mode:char;
	font-size:10.5pt;
	font-family:Century;}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{margin:0mm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:Century;
	font-weight:bold;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{margin-top:12.0pt;
	margin-right:0mm;
	margin-bottom:6.0pt;
	margin-left:0mm;
	text-align:center;
	font-size:16.0pt;
	font-family:Arial;}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{margin:0mm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:Century;}
p.MsoBodyTextIndent, li.MsoBodyTextIndent, div.MsoBodyTextIndent
	{margin-top:0mm;
	margin-right:0mm;
	margin-bottom:0mm;
	margin-left:31.5pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:10.5pt;
	font-size:10.5pt;
	font-family:Arial;}
p.MsoSubtitle, li.MsoSubtitle, div.MsoSubtitle
	{margin:0mm;
	margin-bottom:.0001pt;
	text-align:center;
	font-size:12.0pt;
	font-family:Arial;}
p.MsoDate, li.MsoDate, div.MsoDate
	{margin:0mm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:Century;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p.MsoDocumentMap, li.MsoDocumentMap, div.MsoDocumentMap
	{margin:0mm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	background:navy;
	font-size:10.5pt;
	font-family:Arial;}
p
	{margin-right:0mm;
	margin-left:0mm;
	font-size:12.0pt;
	font-family:"ＭＳ Ｐゴシック";}
pre
	{margin:0mm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"ＭＳ ゴシック";}
p.MsoCommentSubject, li.MsoCommentSubject, div.MsoCommentSubject
	{margin:0mm;
	margin-bottom:.0001pt;
	font-size:10.5pt;
	font-family:Century;
	font-weight:bold;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{margin:0mm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:9.0pt;
	font-family:Arial;}
p.contentfont, li.contentfont, div.contentfont
	{margin-right:0mm;
	margin-left:0mm;
	line-height:15.0pt;
	font-size:9.0pt;
	font-family:Verdana;}
p.default, li.default, div.default
	{margin:0mm;
	margin-bottom:.0001pt;
	text-autospace:none;
	font-size:12.0pt;
	font-family:"Times New Roman";
	color:black;}
p.sp8266242, li.sp8266242, div.sp8266242
	{margin:0mm;
	margin-bottom:.0001pt;
	text-autospace:none;
	font-size:12.0pt;
	font-family:"EHJAP H+ Helvetica";}
p.sp8266260, li.sp8266260, div.sp8266260
	{margin:0mm;
	margin-bottom:.0001pt;
	text-autospace:none;
	font-size:12.0pt;
	font-family:"EHJAP H+ Helvetica";}
p.sp8266294, li.sp8266294, div.sp8266294
	{margin:0mm;
	margin-bottom:.0001pt;
	text-autospace:none;
	font-size:12.0pt;
	font-family:"EHJAP H+ Helvetica";}
span.sc8126981
	{font-family:"EHJAP H+ Helvetica";
	color:black;}
span.msoins0
	{color:teal;
	text-decoration:underline;}
span.msodel0
	{color:red;
	text-decoration:line-through;}
span.msoIns
	{text-decoration:underline;
	color:teal;}
span.msoDel
	{text-decoration:line-through;
	color:red;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:42.55pt 42.55pt 42.55pt 42.55pt;
	layout-grid:14.55pt;}
div.Section1
	{page:Section1;}
-->
</style>

</head>

<body lang=JA link=blue vlink=purple style='text-justify-trim:punctuation'>

<div class=Section1 style='layout-grid:14.55pt'>

<h1><a name="_Ref153876900"></a><a name="_Toc188185538"></a><span lang=EN-US>Chapter
3</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Basics of SPE Programming</span></h1>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>This chapter
describes how to write programs for SPEs, the second characteristic aspect of
Cell programming. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>SIMD programs that
run on the PPE have already been explained in Chapter 2. With the use of the
PPE only, however, it is not possible to benefit fully from the Cell’s huge
potential for computing performance. As stated in Section1.3, effective use of
multiple SPEs is the key to maximizing the performance of the Cell. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The first
section of this chapter presents a brief description of SPE programming. In the
following sections, programming techniques are explained using sample programs.
Several programming exercises are also provided at the end of the
chapter.&nbsp;&nbsp; </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoCaption align=center style='text-align:center'><span lang=EN-US>Table&nbsp;
3.1: Structure of Chapter 3</span></p>

<div align=center>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><span lang=EN-US>Section</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border:solid windowtext 1.0pt;
  border-left:none;background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><span lang=EN-US>Title</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border:solid windowtext 1.0pt;
  border-left:none;background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><span lang=EN-US>Description</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  border-top:none;background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Section 3.1</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>SPE
  Programming Overview</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Explains the fundamentals of SPE programming.</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Section 3.2</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Simple SPE
  Program</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Describes programming for running the SPE program.</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  border-top:none;background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Section 3.3</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Transporting Data by DMA Transfer</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Describes DMA transfer for transferring data between the PPE
  program and the SPE program. </span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Section 3.4</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>SIMD
  Programming on SPE</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Demonstrates SIMD operations using the SPE.</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  border-top:none;background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Section 3.5</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Parallel Programming Using Multiple SPEs</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Describes how to run applications on multiple SPEs.</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Section 3.6</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Exercise (3-1): Parameter Display Program</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>To review your learning from Section 3.2, a program for displaying
  a parameter passed from the PPE program is created. </span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  border-top:none;background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Section 3.7</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Exercise (3-2): Case Conversion Program</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>To review your learning from Sections 3.3 and 3.4, a program for
  lower to upper case character conversion is created. </span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Section 3.8</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Exercise (3-3): Sectional Measurement Program</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>To review your learning from Sections 3.4 and 3.5, a program for
  area calculation using multiple SPEs is created. </span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  border-top:none;background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Section 3.9</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Exercise (3-4): Grayscale Conversion Program (for Single SPE)</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  background:#E6E6E6;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>As a comprehensive review of Chapter 3, a grayscale conversion
  program is created using a single SPE.</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:71.95pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Section
  3.10</span></p>
  </td>
  <td width=245 valign=top style='width:183.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Exercise (3-5): Grayscale Conversion Program (for Multiple SPEs)</span></p>
  </td>
  <td width=295 valign=top style='width:220.95pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>As a comprehensive review of Chapter 3, a grayscale conversion
  program is created using multiple SPE.</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Toc148010404"></a><a
name="_Toc188185539"></a><a name="_Toc154400413"></a><a name="_Ref150919649"></a><a
name="_Ref150919648"></a><a name="_Toc148010747"></a><span lang=EN-US>3.1</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>SPE</span><span lang=EN-US> Programming Overview</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>As already
mentioned, programming the PPE does not differ from C programming on Linux. In contrast,
SPEs must be programmed in a way somewhat different from conventional methods.
Let’s start with a run-through of what we’ve learned in Section 1.3 and the
library used in SPE programming. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><a name="_Toc148010405"></a><a
name="_Toc148010748"></a><span lang=EN-US>3.1.1</span><span lang=EN-US
style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>SPE Program Execution</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The most basic
of the programming models using SPEs is the PPE-centric approach in which the
main program runs on the PPE and sub-programs are executed on SPEs.
Descriptions hereafter are based on this PPE-centric model. Programmers should
note that the execution of SPE programs is controlled via the PPE
program.&nbsp; </span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Fig. 3.1 shows a
typical SPE program execution sequence with the PPE-centric model.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><span
lang=EN-US><img width=387 height=437
src="CellProgrammingTutorial.files/image035.jpg" border=0></span></p>

<p class=MsoCaption align=center style='text-align:center'><a
name="_Ref153198455"><span lang=EN-US>Fig. </span></a><span lang=EN-US>3.1: SPE
Program Execution </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>(PPE Program) Loads the SPE program to the LS.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>(PPE Program) Instructs the SPE to execute the SPE
program.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>(SPE Program) Transfers required data from the main
memory to the LS.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(4)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>(SPE Program) Processes the data in the LS in
accordance with the requirements. </span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(5)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>(SPE Program) Transfers the processed result from the
LS to the main memory.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(6)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>(SPE Program) Notifies the PPE program of the
termination of processing.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The execution
procedure starts by loading the SPE program from the main memory to the LS. The
SPE initiates program execution as soon as the execute command is received from
the PPE program. Data necessary for computation is transferred from the main
memory to the LS and upon completion of processing, the processed result is
returned to the main memory. Then the SPE program terminates and relays this
information back to the PPE program so that the PPE program can further process
the SPE-processed data.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:5.25pt;text-indent:5.25pt'><span
lang=EN-US>For other types of Cell programming models, refer to Section 1.3 of
the “Cell Broadband Engine Programming Tutorial” posted by IBM on the following
website. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>(<u><span style='color:blue'><a
href="http://www.ibm.com/chips/techlib/techlib.nsf/techdocs/FC857AE550F7EB83872571A80061F788">http://www.ibm.com/chips/techlib/techlib.nsf/techdocs/FC857AE550F7EB83872571A80061F788</a></span></u>)</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Arial'>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.1.2</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>SPE Runtime Management Library version 2 (libspe2)</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The SPE Runtime
Management Library (libspe) is used to control SPE program execution from the
PPE program. Developed jointly by Sony Computer Entertainment Inc., IBM and
Toshiba Corporation, this library is licensed under the GNU LPGL. The greatest
difference between version 1 and version 2 lies in the API used. This tutorial
is premised on the use of the libspe version 2 (hereinafter abbreviated as
libspe2). </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>libspe2 does not
rely on the underlying operating system, i.e., it can run on a variety of OS
platforms. An implementation scheme for Linux has already been published. This
scheme makes use of the SPU File System (SPUFS) as the Linux kernel interface. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>libspe2 handles
SPEs as virtual objects called SPE contexts. This means that from the
programming point of view, SPE programs can be loaded and executed by operating
SPE contexts. Libspe2 comprises a set of APIs shown in Fig. 3.2. Among them,
SPE programming explained in this tutorial makes use of the low-level API
offered by the BASE part. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><span
lang=EN-US><img border=0 width=222 height=196
src="CellProgrammingTutorial.files/image036.jpg"></span></p>

<p class=MsoCaption align=center style='text-align:center'><a
name="_Ref153198497"><span lang=EN-US>Fig. </span></a><span lang=EN-US>3.2:
libspe2 Library </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Refer to Section
5 of the “SPUFS: The Cell Synergistic Processing Unit as a virtual file system”
for more information about the SPUFS.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>(<a
href="http://www.ibm.com/developerworks/power/library/pa-cell/">http://www.ibm.com/developerworks/power/library/pa-cell/</a>)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Now then, let us
discuss the details of SPE programming, using specific sample programs. Section</span><span
style='font-family:"ＭＳ 明朝"'>　</span><span lang=EN-US>3.2 describes the
rudimentary programming for loading, executing and terminating an SPE program.
Section 3.3 explains how to transfer data between the PPE program and the SPE
program. Section 3.4 covers SIMD programming on the SPE, and Section 3.5
introduces you to parallel programming using multiple SPEs.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Ref150935424"></a><a
name="_Toc148010750"></a><a name="_Toc148010407"></a><a name="_Toc188185540"></a><a
name="_Toc154400414"></a><a name="_Ref150935548"></a><span lang=EN-US>3.2</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Simple SPE Program</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>This section
describes the basic method of programming using libspe2. Let’s get started with
an easy example of SPE programming that allows a simple SPE program to run on a
single SPE. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.2.1</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>SPE Program Execution Sequence</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>When libspe2 is
used, the SPE program is executed as follows from the PPE program.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Open the SPE program image.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Create the SPE context.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Load the SPE program into the LS.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(4)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Execute the loaded SPE program.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(5)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Destroy the SPE context.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(6)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Close the SPE program image.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Fig. 3.3
provides a graphic representation of these steps.</span></p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><span
lang=EN-US><img border=0 width=467 height=508
src="CellProgrammingTutorial.files/image037.jpg"></span></p>

<p class=MsoCaption align=center style='text-align:center'><a
name="_Ref153198539"><span lang=EN-US>Fig. </span></a><span lang=EN-US>3.3: SPE
Program Execution</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>They are also
detailed in the next sections using a simple SPE executable.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.2.2</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Hello World Program</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>List (3-1) shows
the SPE program for displaying “Hello world!”, taken as an example to explain
the basics of programming for SPE program execution from the PPE program. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-1): Hello world program (for the
SPE)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFCC;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>1 #include &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>2 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>3 int main(unsigned long
  long spe, unsigned long long argp, unsigned long long envp)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>4 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>5&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;Hello world!¥n&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>6 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>7&nbsp;&nbsp;
  &nbsp;&nbsp;return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>8 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Opening the SPE&nbsp; program image</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:8.9pt'><span lang=EN-US>The <b>spe_image_open()
</b>function opens the SPE program image stored in the ELF executable file.
&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition (3-1): Prototype declaration
in the <b>spe_image_open()</b> function</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>spe_program_handle_t *
  spe_image_open(const char *filename);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>filename</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the path (either absolute or relative) to the SPE program’s ELF executable
  file.</span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Return
  value</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>On success, returns the pointer to the opened SPE program
  image handle. On failure, NULL is returned and an error code is set to errno.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Example (3-1)
shows an example of the use of the <b>spe_image_open() </b>function.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Example (3-1): Opening the SPE program
image</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>prog =
  spe_image_open(&quot;./spe_hello.elf&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Creating the SPE context</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Next, the <b>spe_context_create()</b>
function creates a new SPE context. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition (3-2): Prototype declaration
in the <b>spe_context_create()</b> function</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>spe_context_ptr_t
  spe_context_create(unsigned int flags, spe_gang_context_ptr_t gang);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>flags</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the behavior&nbsp; of the SPE context. Set this flag to “0” as it is not used
  in this tutorial.</span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Second
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>gang</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the SPE gang context. Set NULL as the SPE gang context is not used in this
  tutorial. Refer to the terminology list in the “SPE Runtime Management
  Library version 2.0” for more information on the SPE gang context. </span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Return
  value</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>On success, returns the pointer to the newly created SPE
  context. On failure, NULL is returned and an error code is set to errno.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:15.75pt'><span lang=EN-US>When it is no
longer needed by the application, the SPE context is discarded by using the <b>spe_context_destroy()
</b>function.</span></p>

<p class=MsoNormal style='text-indent:15.75pt'><span lang=EN-US>&nbsp;Example
(3-2) shows an example of the use of the<b> spe_context_create()</b> function.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Example (3-2): Creating the SPE context</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>spe = spe_context_create(0,
  NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Loading the SPE program to the LS</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US
style='color:black'>Prior to running the SPE context, the SPE program must be loaded
into the LS. This is done by using the <b>spe_program_load </b>function.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition(3-3): Prototype declaration
in the <b>spe_program_load()</b> function</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>int
  spe_program_load(spe_context_ptr_t spe, spe_program_handle_t *program);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>spe</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the pointer to the SPE context.</span></p>
  </td>
 </tr>
 <tr style='height:4.35pt'>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt;
  height:4.35pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Second
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt;
  height:4.35pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>program</span></i><span
  lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt;
  height:4.35pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>Specifies the pointer to the handle of the SPE program
  image to be loaded into the LS.</span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Return
  value</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>On success, “0” is returned. On failure, “-1” is returned,
  with an error code set to errno.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Example (3-3)
shows an example of the use of the <b>spe_program_load()</b> function.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Example (3-3): Loading the SPE program into
the LS</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>ret = spe_program_load(spe,
  prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(4)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Executing the loaded SPE program</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The <b>spe_context_run()
</b>function requests execution of the program loaded in the SPE context. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition (3-4): Prototype declaration
in the <b>spe_context_run()</b> function</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>int spe_context_run(spe_context_ptr_t
  spe, unsigned int *entry, unsigned int runflags,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  void *argp, void *envp, spe_stop_info_t *stopinfo);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>spe</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the pointer to the SPE context that should be run. </span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Second
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>entry</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=default style='text-align:justify;text-justify:inter-ideograph'><span
  lang=EN-US style='font-size:10.5pt;font-family:Century'>Specifies the pointer
  to the variable containing the address at which the SPE program should start
  executing. </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Normally,
  SPE_DEFAULT_ENTRY is used as this address.</span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Third
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>runflags</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies a
  flag that requests certain specific behavior. </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Normally,
  set to “0” for default behavior. </span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Fourth
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>argp</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the value to be passed to the second argument of the SPE program’s <b>main()</b>
  function.</span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Fifth
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>envp</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the value to be passed to the third argument of the SPE program’s <b>main()</b>
  function. </span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Sixth
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>stopinfo</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the pointer to the variable used to store information on the reason why the
  SPE program stopped execution.</span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Return
  value</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>On success, “0” or a positive number is returned. On
  failure, “-1” is returned and an error code is set to errno.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Refer to the
“SPE Runtime Management Library Version 2.0” for detailed specifications of
individual arguments.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(<a
href="http://www.ibm.com/chips/techlib/techlib.nsf/techdocs/1DFEF31B3211112587257242007883F3">http://www.ibm.com/chips/techlib/techlib.nsf/techdocs/1DFEF31B3211112587257242007883F3</a>)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Control is
passed to the SPE program when the <b>spe_context_run() </b>function is called
and returned to the PPE program when the SPE program is terminated. The return
value is “0” when returned from the SPE program’s <b>main()</b> function or
when the <b>exit()</b> function is called by the SPE program. In other cases, a
value other than “0” is returned. Information about the interruption of SPE
program execution is stored in the area specified by the sixth argument <i>stopinfo</i>.&nbsp;
</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp;Example
(3-4) shows an example of the use of the <b>spe_context_run()</b> function. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Example (3-4): Executing the loaded SPE
program</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>ret = spe_context_run(spe,
  &amp;entry, 0, NULL, NULL, &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(5)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Destroying the SPE context</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The <b>spe_context_destroy()
</b>function destroys the SPE context that is no longer needed by the
application after the execution of the SPE program. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition (3-5): Prototype declaration
in the <b>spe_context_destroy()</b> function</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>int
  spe_context_destroy(spe_context_ptr_t spe);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>spe</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the pointer to the SPE context that should be destroyed.</span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Return
  value</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>On success, “0” is returned. On failure, “-1” is returned
  and an error code is set to errno.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Example (3-5)
shows an example of the use of the<b> spe_context_destroy()</b> function.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Example (3-5): Destroying the SPE context</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>ret =
  spe_context_destroy(spe);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(6)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Closing the SPE program image</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The <b>spe_image_close()</b>
function closes the SPE program image that was opened in Step (1). </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition (3-6): Prototype declaration
in the&nbsp; <b>spe_image_close()</b> function</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>int
  spe_image_close(spe_program_handle_t *program);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>program</span></i></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the pointer to the handle of the SPE program image that should be closed. </span></p>
  </td>
 </tr>
 <tr>
  <td width=139 valign=top style='width:104.4pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Return
  value</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=470 valign=top style='width:352.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>On success, “0” is returned. On failure, “-1” is returned
  and an error code is set to errno.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Example (3-6)
shows an example of the use of the<b> spe_image_close()</b> function.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Example (3-6): Closing the SPE program
image</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>ret =
  spe_image_close(prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>This completes a
quick rundown of how to program execution of the SPE program from the PPE
program using libspe2.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.2.3</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Sample Program</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Now, let’s take
a look at the entire source code you need to write for the above operation. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Sample Program (3-1):&nbsp; Hello world
program (PPE program)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include
  &lt;stdlib.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 #include
  &lt;libspe2.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 int main(int argc,
  char **argv)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;
  spe_context_ptr_t spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10&nbsp;&nbsp;&nbsp;&nbsp;
  spe_program_handle_t *prog;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int entry;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12&nbsp;&nbsp;&nbsp;&nbsp;
  spe_stop_info_t stop_info;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14&nbsp;&nbsp;&nbsp;&nbsp;
  prog = spe_image_open(&quot;hello_spe.elf&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15&nbsp;&nbsp;&nbsp;&nbsp;
  if (!prog) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_open&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20&nbsp;&nbsp;&nbsp;&nbsp;
  spe = spe_context_create(0, NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21&nbsp;&nbsp;&nbsp;&nbsp; if
  (!spe) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_program_load(spe, prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>27&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>28&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_program_load&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>31 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>32&nbsp;&nbsp;&nbsp;&nbsp;
  entry = SPE_DEFAULT_ENTRY;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>33&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_run(spe, &amp;entry, 0, NULL, NULL, &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>34&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret &lt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_run&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>37&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>38 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>39&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_destroy(spe);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>40&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>41&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_destroy&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>43&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>45&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_image_close(prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>46&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>47&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_close&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>49&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 3</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  include the header file “</span><span lang=EN-US style='font-family:"Courier New"'>libspe2.h</span><span
  lang=EN-US>” required for controlling the SPE. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 9</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>12</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  declare the variables for handling the SPE program and context. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 14</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Using the <b>spe_image_open()</b>
  function, opens the SPE program image to be executed. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 20</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Using the <b>spe_context_create()</b>
  function, creates the SPE context. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 26</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Using the <b>spe_program_load()</b>
  function, loads the SPE program into the LS.</span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 33</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Using the <b>spe_context_run()</b>
  function, executes the SPE program. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 39</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Using the <b>spe_context_destroy()</b>
  function, destroys the executed SPE context. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 45</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Using the <b>spe_image_close()</b>
  function, closes the previously opened SPE program image. </span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Sample Program (3-2):&nbsp; Hello world
program (SPE program)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFCC;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>1 #include &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>2 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>3 int main(unsigned long
  long spe, unsigned long long argp, unsigned long long envp)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>4 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>5&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;Hello world!¥n&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>6 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>7&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>8 }</span></p>
  <p class=MsoNormal style='margin-right:18.0pt;layout-grid-mode:char'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 3</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  pass the assigned SPE ID to the first argument <i>spe</i> of the <b>main()</b>
  function. To the second and third arguments of this function, the fourth and
  fifth arguments (<i>argp </i>and <i>envp</i>) of the PPE-called <b>spe_context_run()</b>
  function are passed respectively. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 5</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  display the message “Hello world!” on the standard output.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US><a
href="src/example3_1/">Click here for the source code for the hello world
program. </a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.2.4</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Program Compilation and Execution</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Before getting
started, please confirm that your development environment complies with the
requirements described in Section 1.4.&nbsp; Any application developed by
utilizing the SPE includes both PPE and SPE programs, making it necessary to
compile the source code separately into two ELF executable files. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>To compile the
PPE program, use the </span><b><span lang=EN-US style='font-family:Arial'>gcc</span></b><span
lang=EN-US> command. The use of the libspe2 library entails the need to specify
</span><b><span lang=EN-US style='font-family:Arial'>-lspe2</span></b><span
lang=EN-US> as a </span><b><span lang=EN-US style='font-family:Arial'>gcc</span></b><span
lang=EN-US> linker option to link to </span><span lang=EN-US style='font-family:
"Courier New"'>libspe2.so. </span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Compilation of
the SPE program is performed by the </span><b><span lang=EN-US
style='font-family:Arial'>spu-gcc </span></b><span lang=EN-US>command. The
example below shows how to compile the hello world program. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Example (3-7):&nbsp; Program compilation</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>$ gcc -lspe2 hello_ppe.c -o
  hello_ppe.elf</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>$ spu-gcc hello_spe.c -o
  hello_spe.elf</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>To execute the
application, run the PPE program at the shell prompt. The example below shows
how to execute the hello world program. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Example (3-8): Program execution</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>$ ./hello_ppe.elf</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>Hello world!</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>$ </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Ref152490803"></a><a
name="_Toc188185541"></a><a name="_Toc154400415"></a><a name="_Ref152490858"></a><a
name="_Ref152490841"></a><span lang=EN-US>3.3</span><span lang=EN-US
style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Transporting Data by DMA Transfer</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>A data transfer
system called DMA transfer is used to move data between the PPE program and the
SPE program. In the next few pages, we will take a brief look at what it is and
how it is set up between the PPE program and the SPE program. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><a name="_Ref153249666"><span
lang=EN-US>3.3.1</span></a><span lang=EN-US style='font-size:7.0pt;font-family:
"Times New Roman"'>&nbsp;&nbsp; </span><span lang=EN-US>DMA Transfer Overview</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>As explained
previously in Section 1.2, each SPE has its own local memory called the LS.
This, however, is the only memory the SPE can access directly. In order to
allow the SPE program to share the main memory’s data with the PPE program, it
is necessary to furnish some way of transferring data between the main memory
and the LS.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>DMA (Direct
Memory Access) transfer is a method whereby data is transferred from memory to
peripheral devices without using the CPU. The Cell capitalizes on this
high-speed data transfer to make data transfer possible between the main memory
and the LS. DMA transfer between these two memories is basically governed by
the SPE program and executed in the following sequence. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Issues a DMA transfer command.</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Executes DMA transfer between the main memory and the
LS.</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Waits for the completion of DMA transfer.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Fig. 3.4
provides a graphic representation of these steps. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><span
lang=EN-US><img border=0 width=377 height=444
src="CellProgrammingTutorial.files/image038.jpg"></span></p>

<p class=MsoCaption align=center style='text-align:center'><a
name="_Ref153198581"><span lang=EN-US>Fig. </span></a><span lang=EN-US>3.4: DMA
Transfer</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In Step (1), the
SPE program sends a DMA transfer command to the MFC. Execution of DMA transfer
is performed by the DMA controller contained in the MFC.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In Step (2), the
MFC’s DMA controller initiates a DMA transfer upon receipt of the DMA transfer
command by the MFC. Once the command is issued, the SPE program can continue
execution in parallel with the DMA transfer by the MFC.&nbsp; </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The SPE program
checks the completion of the MFC’s DMA transfer prior to using the transferred
data. This process of checking is indicated by Step 3.</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>After ensuring
that DMA transfer is completed successfully, the SPE program starts necessary
computational operations on the data. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The SPU utilizes
channels as the primary interface for transporting requests and data to and from
the MFC. For instance, the DMA transfer command and information about the
completion of DMA transfer are sent and received through this interface. There
are a variety of channels designed for a variety of purposes. Refer to Chapter
9 of the “Cell Broadband Engine Architecture” for details of the channel
interface. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>(<a href="http://cell.scei.co.jp/">http://cell.scei.co.jp/</a>)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.3.2</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Programming DMA Transfer</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>This section
focuses on programming DMA transfer. List (3-2) shows the SPE program that
causes DMA transfer to occur from the main memory to the LS.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-2): Execution of DMA transfer (SPE
program)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='background:#CCFFCC;border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>1
  spu_mfcdma64(&amp;abs_params, mfc_ea2h(argp), mfc_ea2l(argp),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  sizeof(abs_params_t), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>3 spu_writech(MFC_WrTagMask,
  1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>4
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Issuing a DMA transfer command</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The DMA transfer
command is issued to the MFC using the <b>spu_mfcdma64()</b> function.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The<b>
spu_mfcdma64()</b> function makes it possible to issue the command so that the
specified number of data bytes are transferred in the specified direction
between the specified areas of the main memory and the LS.&nbsp; </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The main memory
and the LS have different address spaces. The main memory address used by the
PPE program is the effective address (EA), whereas the LS address used by the
SPE program is called the local storage address (LSA). </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition (3-7): Prototype declaration
in the <b>spu_mfcdma64()</b> function</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New";color:blue'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>void spu_mfcdma64(volatile void
  *lsa, unsigned int eahi, unsigned int ealow,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int&nbsp; size, unsigned int tagid, unsigned int cmd);</span></p>
  <p class=MsoNormal align=left style='text-align:left;text-autospace:none'><span
  lang=EN-US style='font-size:9.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>lsa</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the initial address (LSA) of the memory area of the LS used for DMA transfer.
  </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Second
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>eahi</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the upper 32 bits of the initial address (EA) of the memory area of the main
  memory used for DMA transfer. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Third
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>ealow</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the lower 32 bits of the initial address (EA) of the memory area of the main memory
  used for DMA transfer.</span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Fourth
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>size</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the size of data to be transferred. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Fifth
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>tagid</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the DMA tag number in a range from 0 to 31. </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>This tag number
  is used as an identifier to check the completion of DMA transfer. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Sixth
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>cmd</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the transfer direction: <br>
  MFC_GET_CMD to transfer (GET) data from the main memory to the LS.</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>MFC_PUT_CMD
  to transfer (PUT) data from the LS to the main memory.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:5.25pt;text-indent:5.25pt'><span
lang=EN-US>The initial addresses specified for the first, second and third
arguments (<i>lsa, eahi </i>and <i>ealow</i>) must be aligned to 16-byte
boundaries. The data size specified for the fourth argument (<i>size</i>) must
be a multiple of 16 bytes. The maximum specifiable data size is 16 Kbytes. If
the values of these arguments are not appropriately set, DMA transfer cannot be
executed normally due to the constraints immanent in the Cell architecture.
Restrictions on DMA transfer will be discussed in more detail in Section 4.2.1.
</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In addition, two
macros <b>mfc_ea2h()</b> and <b>mfc_ea2l()</b> are defined to make it possible
to extract higher 32 bits and the lower 32 bits respectively from the 64-bit
effective address for use as the second argument <i>eahi </i>and the third
argument <i>ealow</i> . </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition (3-8): Definition of the <b>mfc_ea2h()
</b>macro</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>#define
  mfc_ea2h(ea)&nbsp;&nbsp; (unsigned int)((unsigned long long)(ea)&gt;&gt;32)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>ea</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='margin-left:3.55pt;layout-grid-mode:char'><span
  lang=EN-US>Effective address on the main memory</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition (3-9): Definition of
the&nbsp; <b>mfc_ea2l()</b> macro</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>#define
  mfc_ea2l(ea)&nbsp;&nbsp; (unsigned int)(ea)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>ea</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Effective
  address on the main memory</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>After requesting
DMA transfer, the <b>spu_mfcdma64()</b> function returns without waiting for
the completion of DMA transfer. This makes it necessary for the SPE program to
wait for the completion of DMA transfer, because DMA transfer is executed by
the DMA controller independently of the SPU. Example (3-9) shows an example of
the use of the <b>spu_mfcdma64()</b> function.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Example (3-9): Issuing a DMA transfer
command</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='background:#CCFFCC;border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>spu_mfcdma64(&amp;spe_params,
  mfc_ea2h(argp), mfc_ea2l(argp),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  sizeof(spe_prog_arg_t), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Executing DMA transfer between the main memory and the
LS</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The MFC executes
data transfer between the main memory and the LS according to the direction
specified in the DMA transfer command received from the SPE program. Data
transfer is performed asynchronously with the execution of the SPE program. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Waiting for the completion of DMA transfer</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>As the <b>spu_mfcdma64()</b>
function returns without waiting for the completion of DMA transfer, the SPE
program is required to confirm whether it is completed successfully. To do
this, the SPE program uses the <b>spu_writech()</b> macro and the <b>spu_mfcstat()</b>
function.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.55pt'><b><span lang=EN-US>spu_writech()
</span></b><span lang=EN-US>is a macro used for data passing from the SPU to
the MFC via the channel interface. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition (3-10): Definition of the <b>spu_writech()</b>
macro</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New";color:blue'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>#define spu_writech(imm,
  ra) si_wrch((imm), si_from_uint(ra))</span></p>
  <p class=MsoNormal align=left style='text-align:left;text-autospace:none'><span
  lang=EN-US style='font-size:9.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>imm</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the channel to be used.</span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Second
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>ra</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the data to be passed to the MFC.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>To await the completion
of DMA transfer, the tag number must be notified to the MFC using the <b>spu_writech()
</b>macro.<b> </b>The WrTagMask channel is used for this purpose. A bit flag
corresponding to the tag number specified by the fifth argument <i>tagid</i> of
the <b>spu_mfcdma64() </b>function is also passed.&nbsp; </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The tag is
updated every time a tagged DMA transfer command is executed. The update status
can be confirmed by using the <b>spu_mfcstat()</b> function. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>API Definition (3-11): Prototype
declaration for the <b>spu_mfcstat()</b> function</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New";color:blue'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>unsigned int
  spu_mfcstat(unsigned int type);</span></p>
  <p class=MsoNormal align=left style='text-align:left;text-autospace:none'><span
  lang=EN-US style='font-size:9.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:40.0mm;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>First
  argument</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><i><span lang=EN-US>type</span></i></p>
  </td>
  <td width=458 valign=top style='width:343.7pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Specifies
  the method to check tag update.</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Typically,
  specify MFC_TAG_UPDATE_ALL.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>When calling the
MFC to check the completion of DMA transfer, make sure to use the <b>spu_writech()</b>
macro simultaneously with the <b>spu_mfcstat()</b> function. Example (3-10)
shows an example of how they are used. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Example (3-10): Waiting for the completion
of DMA transfer</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='background:#CCFFCC;border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>spu_writech(MFC_WrTagMask,
  1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>This completes
the tutorial on the execution of DMA transfer.</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In the next
section, we will look at a sample of a typical program that involves DMA
transfer.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.3.3</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Absolute Value Calculation Program Using DMA Transfer</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Remember the
absolute value calculation program that we worked on in Exercise (2-3)? </span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>It can be
written as follows if we were to take advantage of DMA transfer to enable the
SPE program to perform the necessary calculations.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-3): Absolute value calculation
program (PPE program) (Partial)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='background:#CCFFCC;border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>1 abs_params.ea_in&nbsp; =
  (unsigned long) in;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>2 abs_params.ea_out =
  (unsigned long) out;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>3
  abs_params.size&nbsp;&nbsp; = SIZE;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>4</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>5 ret =
  spe_context_run(spe, &amp;entry, 0, &amp;abs_params, NULL, &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-4): Absolute value calculation
program (SPE program) (Partial)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='background:#CCFFCC;border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 /* DMA Transfer 1 :
  GET input/output parameters */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2
  spu_mfcdma64(&amp;abs_params, mfc_ea2h(argp), mfc_ea2l(argp),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  sizeof(abs_params_t), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4 spu_writech(MFC_WrTagMask,
  1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7 /* DMA Transfer 2 :
  GET input data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8
  spu_mfcdma64(in_spe, mfc_ea2h(abs_params.ea_in), mfc_ea2l(abs_params.ea_in),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params.size * sizeof(float), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13 /* Calculate absolute
  values */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14 for (i = 0; i &lt;
  abs_params.size; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15&nbsp;&nbsp;&nbsp;&nbsp;
  if (in_spe[i] &gt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  out_spe[i] = in_spe[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17&nbsp;&nbsp;&nbsp;&nbsp;
  } else {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  out_spe[i] = in_spe[i] * -1;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22 /* DMA Transfer 3 : PUT
  output data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23 spu_mfcdma64(out_spe,
  mfc_ea2h(abs_params.ea_out), mfc_ea2l(abs_params.ea_out),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params.size * sizeof(float), tag, MFC_PUT_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25 spu_writech(MFC_WrTagMask,
  1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In a nutshell,
the SPE program executes calculations in the following sequence. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Obtains data from the main memory via DMA transfer.
(GET)</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Processes data.</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Returns the processed result to the main memory via DMA
transfer. (PUT)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The SPE program
has no direct means of knowing what data exists in which area of the main
memory. Hence, the PPE program creates a parameter set containing information
about the data to be processed by the SPE program (effective addresses and size
of input/output data), stores it in advance in the main memory, and passes its
effective address to the fourth argument of the <b>spe_context_run()</b>
function. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>As shown in Fig.
3.5, DMA transfer occurs three times before the SPE program finishes the
calculation task. </span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>DMA transfer of input/output parameters (GET)</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>DMA transfer of input data (GET)</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>DMA transfer of output data (PUT)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><span
lang=EN-US><img border=0 width=335 height=395
src="CellProgrammingTutorial.files/image039.jpg"></span></p>

<p class=MsoCaption align=center style='text-align:center'><a
name="_Ref153199914"><span lang=EN-US>Fig. </span></a><span lang=EN-US>3.5:
Parameter Passing by DMA Transfer</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Initial DMA
transfer (GET): Transfers the input/output data parameter set <i>abs_params </i>into
the LS. This parameter set provides the effective addresses of the main memory
used in the second and third DMA transfers, as well as the data size
information necessary for calculations. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Second DMA
transfer (GET): Using the effective address <i>ea_in</i> contained in the
parameter set, transfers data from the main memory to the data area <i>in_spe</i>
of the LS for processing (absolute value calculation in this example) by the
SPE program.&nbsp; </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Third DMA
transfer (PUT): Using the effective address <i>ea_out</i> indicating the output
destination address, transfers the calculated result from the scalar array <i>out_spe</i>
to the data area of the main memory. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The use of the <b>spe_context_run()</b>
function is not the only means of passing parameters to the SPE program. There
are other ways of performing the same operation using the MFC functions. Refer
to Section 4.1 for a more detailed explanation.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.3.4</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Sample Program</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The following
illustrates the entire source code you need to write to perform the above
absolute value calculations using DMA transfer. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Sample Program (3-3): Absolute value
calculation program using DMA transfer (PPE program)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include
  &lt;stdlib.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 #include
  &lt;libspe2.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 #define
  SIZE&nbsp;&nbsp;&nbsp; (64)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7 float
  in[SIZE]&nbsp; __attribute__((aligned(16))) = {&nbsp; 1,&nbsp; -2,&nbsp; 3,
  &nbsp;-4,&nbsp; 5,&nbsp; -6,&nbsp; 7,&nbsp; -8,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  9, -10, 11, -12, 13, -14, 15, -16,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  17, -18, 19, -20, 21, -22, 23, -24,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  25, -26, 27, -28, 29, -30, 31, -32,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  33, -34, 35, -36, 37, -38, 39, -40,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  41, -42, 43, -44, 45, -46, 47, -48,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;49, -50, 51, -52, 53, -54, 55, -56,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  57, -58, 59, -60, 61, -62, 63, -64 };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15 float out[SIZE]
  __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>17 typedef
  struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>18&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_in;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>19&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_out;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>20&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; size;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>21&nbsp;&nbsp;&nbsp;&nbsp;
  int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pad[3];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>22 }
  abs_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24 abs_params_t abs_params
  __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26 int main(int argc, char
  **argv)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>27 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>28&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>31&nbsp;&nbsp;&nbsp;&nbsp;
  spe_context_ptr_t spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>32&nbsp;&nbsp;&nbsp;&nbsp;
  spe_program_handle_t *prog;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>33&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int entry;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>34&nbsp;&nbsp;&nbsp;&nbsp;
  spe_stop_info_t stop_info;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36&nbsp;&nbsp;&nbsp;&nbsp;
  prog = spe_image_open(&quot;abs_spe.elf&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>37&nbsp;&nbsp;&nbsp;&nbsp;
  if (!prog) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_open&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>39&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>40&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>41 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>42&nbsp;&nbsp;&nbsp;
  &nbsp;spe = spe_context_create(0, NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>43&nbsp;&nbsp;&nbsp;&nbsp;
  if (!spe) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>46&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>47 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>48&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_program_load(spe, prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>49&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_program_load&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>53 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>54&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params.ea_in&nbsp; = (unsigned long) in;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>55&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params.ea_out = (unsigned long) out;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>56&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params.size&nbsp;&nbsp; = SIZE;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>57 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>58&nbsp;&nbsp;&nbsp;&nbsp;
  entry = SPE_DEFAULT_ENTRY;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>59&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_run(spe, &amp;entry, 0, &amp;abs_params, NULL, &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>60&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret &lt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>61&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_run&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>62&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>63&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>64 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>65&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_destroy(spe);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>66&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>67&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_destroy&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>68&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>69&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>70 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>71&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_image_close(prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>72
  &nbsp;&nbsp;&nbsp;&nbsp;if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>73&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_close&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>74&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>75&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>76 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>77&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; SIZE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>78&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;out[%02d]=%0.0f¥n&quot;, i, out[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>79&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>80 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>81&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>82 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 17</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>22</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  define the data type <i>abs_params_t </i>of the parameter set to be passed to
  the SPE program. By <i>pad[3]</i>, data is padded into 32 bytes for DMA
  transfer, which requires the data size to be a multiple of 16 bytes. Refer to
  Section 4.2.1 for more information about the byte size format and alignment. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 54</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>56</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to set
  the parameters (effective addresses of scalar arrays <i>in</i> and <i>out</i>,
  plus array size) to be passed to the SPE program.</span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 59</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  specify the effective address of the parameter set <i>abs_params</i> that is
  passed to the SPE program as the fourth argument of the <b>spe_context_run()</b>
  function. </span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Sample Program (3-4): Absolute value
calculation program using DMA transfer (SPE program)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFCC;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include &lt;spu_intrinsics.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 #include
  &lt;spu_mfcio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 #define MAX_BUFSIZE
  (128)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7 float
  in_spe[MAX_BUFSIZE]&nbsp; __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8 float
  out_spe[MAX_BUFSIZE] __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_in;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_out;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; size;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14&nbsp;&nbsp;&nbsp;&nbsp;
  int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pad[3];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15 } abs_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17 abs_params_t abs_params
  __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19 int main(unsigned long
  long spe, unsigned long long argp, unsigned long long envp)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22&nbsp;&nbsp;&nbsp;&nbsp;
  int tag = 1;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 1 : GET input/output parameters */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>25&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(&amp;abs_params, mfc_ea2h(argp), mfc_ea2l(argp),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>26&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  sizeof(abs_params_t), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>27&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>28&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 2 : GET input data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>31&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(in_spe, mfc_ea2h(abs_params.ea_in), mfc_ea2l(abs_params.ea_in),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params.size * sizeof(float), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>33&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>34&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36&nbsp;&nbsp;&nbsp;&nbsp;
  /* Calculate absolute values */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>37&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; abs_params.size; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (in_spe[i] &gt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>39&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out_spe[i] = in_spe[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  } else {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>41&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  out_spe[i] = in_spe[i] * -1;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>43&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>45&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 3 : PUT output data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>46&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(out_spe, mfc_ea2h(abs_params.ea_out),
  mfc_ea2l(abs_params.ea_out),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>47&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params.size * sizeof(float), tag, MFC_PUT_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>48&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>49&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 2</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>3</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  include the header files “</span><span lang=EN-US style='font-family:"Courier New"'>spu_intrinsics.h</span><span
  lang=EN-US>” and “</span><span lang=EN-US style='font-family:"Courier New"'>spu_mfcio.h</span><span
  lang=EN-US>” necessary to make use of the SPE-specific intrinsics and macros.
  </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 25</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>26</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  issue the DMA transfer command that transfers the parameter set <i>abs_params</i>
  from the main memory to the LS.</span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 27</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>28</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  make the SPE program wait for the completion of DMA transfer.</span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 31</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>32</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  issue the DMA transfer command that transfers data from the effective address
  of the main memory specified by <i>abs_params.ea_in </i>to the variable <i>in_spe</i>.
  </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 33</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>34</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  make the SPE program wait for the completion of DMA transfer.</span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 37</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>43</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  make the SPE program calculate absolute values and store them in the variable
  <i>out_spe</i>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 46</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>47</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  issue the DMA transfer command that transfers data from the variable <i>out_spe</i>
  to the effective address specified by <i>abs_params.ea_out</i>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 48</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>49</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  make the SPE program wait for the completion of DMA transfer.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US><a
href="src/example3_2/">Click here for the source code for absolute value
calculations using DMA transfer.</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Ref150935428"></a><a
name="_Toc188185542"></a><a name="_Toc154400416"></a><a name="_Ref151233517"></a><a
name="_Ref151233500"></a><a name="_Ref150935551"></a><span lang=EN-US>3.4</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>SIMD</span><span lang=EN-US> Programming on SPE</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In Chapter 4, we
have learned that SIMD programming on the PPE uses SIMD instructions called VMX
instructions. Likewise, the SPE supports the SIMD architecture. It is
implemented with SIMD instructions called SPU SIMD instructions. SIMD
operations on the SPE using these instructions are described below. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.4.1</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Absolute Value Calculation Program Using SPU SIMD Instructions</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The concept of
SIMD operations, as well as the actual programming method, does not vary a
great deal whether we use the PPE or SPE. With respect to both types of
processor cores, SIMD programming can basically be performed by using the
built-in functions (intrinsics) corresponding to VMX or SPU SIMD instructions. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>List (3-5) shows
part of the solution program for Exercise (2-3) whereby absolute values are
calculated using VMX instructions. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-5): Absolute value calculation
using VMX instructions </span></p>

<p class=MsoNormal style='text-indent:50.2pt'><span lang=EN-US>(PPE program,
with VMX intrinsics indicated in red)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 for (i = 0; i &lt;
  SIZE/4; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2&nbsp;&nbsp;&nbsp;
  &nbsp;vpat = <b><span style='color:red'>vec_cmpgt</span></b>(vin[i], vzero);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3
  &nbsp;&nbsp;&nbsp;&nbsp;vin_negative = <b><span style='color:red'>vec_madd</span></b>(vin[i],
  vminus, vzero);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4
  &nbsp;&nbsp;&nbsp;&nbsp;vout[i] = <b><span style='color:red'>vec_sel</span></b>(vin_negative,
  vin[i], vpat);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>This program can
be re-written as follows if we were to use SPU SIMD instructions. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-6):&nbsp; Absolute value
calculation using SPU SIMD instructions </span></p>

<p class=MsoNormal style='text-indent:50.2pt'><span lang=EN-US>(SPE program, with
SPU SIMD intrinsics indicated in red)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFCC;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 for (i = 0; i &lt;
  SIZE/4; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2
  &nbsp;&nbsp;&nbsp;&nbsp;vpat = <b><span style='color:red'>spu_cmpgt</span></b>(vin[i],
  vzero);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3
  &nbsp;&nbsp;&nbsp;&nbsp;vin_negative = <b><span style='color:red'>spu_madd</span></b>(vin[i],
  vminus, vzero);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4
  &nbsp;&nbsp;&nbsp;&nbsp;vout[i] = <b><span style='color:red'>spu_sel</span></b>(vin_negative,
  vin[i], vpat);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>As can be seen
from the above comparison, SIMD programming on the SPE can be achieved simply
by replacing the PPE’s VMX intrinsics with the equivalent SPU SIMD intrinsics. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.4.2</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Built-in Functions for SPU SIMD Instructions (Intrinsics)</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Like VMX instructions,
a variety of built-in functions are provided for SPU SIMD instructions. Many of
the built-in functions for SPU SIMD instructions are in one-to-one
correspondence with those for VMX instructions as demonstrated by the
comparison chart in Table 3.2. To remain coherent with Table 2.4, the chart
shows representative examples only. .</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoCaption align=center style='text-align:center'><a
name="_Ref150929805"><span lang=EN-US>Table </span></a><span lang=EN-US>3.2:&nbsp;
SIMD Built-in Functions</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=695
 style='width:521.0pt;border-collapse:collapse'>
 <tr>
  <td width=115 valign=top style='width:86.4pt;border:solid windowtext 1.0pt;
  background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><span lang=EN-US>Applicable </span></p>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><span lang=EN-US>Instructions</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border:solid windowtext 1.0pt;
  border-left:none;background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><span lang=EN-US>VMX</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border:solid windowtext 1.0pt;
  border-left:none;background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><span lang=EN-US>SPU SIMD</span></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border:solid windowtext 1.0pt;
  border-left:none;background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><span lang=EN-US>Description</span></p>
  </td>
 </tr>
 <tr>
  <td width=115 rowspan=5 valign=top style='width:86.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Arithmetic
  Instructions</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_add(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_add(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Adds the
  elements of vectors <i>a </i>and <i>b.</i></span></p>
  </td>
 </tr>
 <tr>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_sub(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu _sub(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Performs
  subtractions between the elements of&nbsp; vectors <i>a </i>and<i> b. </i></span></p>
  </td>
 </tr>
 <tr>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_madd(a,b,c)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_madd(a,b,c)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Multiplies the elements of vector <i>a </i>by the elements of
  vector<i> b </i>and adds the elements of <span style='color:blue'>&nbsp;</span>vector
  <i>c<span style='color:blue'>.</span></i></span></p>
  </td>
 </tr>
 <tr>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_re(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_re(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Calculates the reciprocals of the elements of vector a.</span></p>
  </td>
 </tr>
 <tr>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_rsqrte(a)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_rsqrte(a)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Calculates
  the square roots of the reciprocals of the elements of vector <i>a.</i></span></p>
  </td>
 </tr>
 <tr>
  <td width=115 rowspan=2 valign=top style='width:86.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Logical
  Instructions</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_and(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_and(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Finds
  the bitwise logical products (AND) between vectors <i>a</i> and <i>b</i>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_or(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_or(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Finds
  the bitwise logical sums (OR) between vectors <i>a</i> and <i>b</i>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=115 rowspan=2 valign=top style='width:86.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Shift/Rotate
  Instructions</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_sr(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_rlmask(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Right-shifts
  the elements of vector <i>a</i></span></p>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>in
  accordance with the number of bits specified by the elements of vector <i>b</i>.
  </span></p>
  </td>
 </tr>
 <tr>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_rl(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_rlqwbyte(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Left-rotates
  the elements of vector <i>a</i></span></p>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>in
  accordance with the number of bits specified by the elements of vector<i> b</i>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=115 rowspan=2 valign=top style='width:86.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Bit
  Operation Instructions</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_perm(a,b,c)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_shuffle(a,b,c)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='margin-left:.65pt;text-align:left;
  text-indent:-.65pt'><span lang=EN-US>Realigns the elements of vectors <i>a</i>
  and <i>b</i> </span></p>
  <p class=MsoNormal align=left style='margin-left:.65pt;text-align:left;
  text-indent:-.65pt'><span lang=EN-US>so that they match the byte pattern
  specified by vector <i>c</i>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_sel(a,b,c)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_sel(a,b,c)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Selects
  the bits in vectors <i>a</i> and <i>b</i> according to the bit pattern
  specified by vector <i>c</i>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=115 rowspan=2 valign=top style='width:86.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Compare
  Instructions</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_cmpeq(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_cmpeq(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='margin-left:.65pt;text-align:left;
  text-indent:-.65pt'><span lang=EN-US>Compares if the elements of vector <i>a</i>
  are equal to the elements of vector <i>b</i>.&nbsp; </span></p>
  </td>
 </tr>
 <tr>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_cmpgt(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_cmpgt(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Checks
  if the elements of vector <i>a </i>are numerically greater than those of
  vector <i>b</i>. </span></p>
  </td>
 </tr>
 <tr>
  <td width=115 rowspan=2 valign=top style='width:86.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Conversion
  Instructions</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_ctf(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_convtf(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Divides the elements of integer vector <i>a</i> by 2<i><sup>b </sup></i>and
  converts them into floating-point values.</span></p>
  </td>
 </tr>
 <tr>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_ctu(a,b)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_convtu(a,b)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Multiplies the elements of floating-point vector <i>a</i> by 2<i><sup>b
  </sup></i>and converts them into unsigned integers.</span></p>
  </td>
 </tr>
 <tr>
  <td width=115 valign=top style='width:86.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>Constant
  Generation Instructions</span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>vec_splats_s32(a)</span></b></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><b><span lang=EN-US>spu_splats(a)</span></b></p>
  </td>
  <td width=315 valign=top style='width:236.6pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Generates a new vector by expanding the scalar literal <i>a</i>
  into four signed 32-bit equivalent data.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Table 3.2 shows
typical SPU SIMD intrinsic functions only. If you need more information, please
refer to the “C/C++ Language Extensions for Cell Broadband Engine Architecture”
published by IBM.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(<a
href="http://cell.scei.co.jp/">http://cell.scei.co.jp/</a>)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.4.3</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Sample Program</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The following
illustrates the entire source code you need to write for the SPE to enable
absolute value calculations using SPU SIMD instructions. <span
style='left:0px;position:absolute;z-index:1'><img border=0 width=2 height=2
src="CellProgrammingTutorial.files/image040.gif"></span></p>

</span>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The program is
derived from the sample SPE program introduced in Section 3.3. A supplementary
explanation about the changes made to the original program is provided below
the program. The PPE program is not presented here as it is no different from
the original in Section 3.3, except for the name of the ELF executable file for
the SPE program. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Sample Program (3-5): Absolute value
calculation program using SPU SIMD instructions (SPE program)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFCC;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include
  &lt;spu_intrinsics.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 #include
  &lt;spu_mfcio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 #define MAX_BUFSIZE
  (128)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7 float
  in_spe[MAX_BUFSIZE]&nbsp; __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8 float
  out_spe[MAX_BUFSIZE] __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_in;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_out;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; size;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14&nbsp;&nbsp;&nbsp;&nbsp;
  int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pad[3];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15 } abs_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17 abs_params_t abs_params
  __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19 int main(unsigned long
  long spe, unsigned long long argp, unsigned long long envp)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22&nbsp;&nbsp;&nbsp;&nbsp;
  int tag = 1;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float *vin&nbsp; = (__vector float *) in_spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float *vout = (__vector float *) out_spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vin_negative;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>27&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned int vpat;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>28 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vzero&nbsp; = (__vector float) {&nbsp; 0,&nbsp; 0,&nbsp;
  0,&nbsp; 0 };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vminus = (__vector float) { -1, -1, -1, -1 };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>31 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>32&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 1 : GET input/output parameters */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>33&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(&amp;abs_params, mfc_ea2h(argp), mfc_ea2l(argp),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>34&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  sizeof(abs_params_t), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>37 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>38&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 2 : GET input data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>39&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(vin, mfc_ea2h(abs_params.ea_in), mfc_ea2l(abs_params.ea_in),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params.size * sizeof(float), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>41&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>42&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>43 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44&nbsp;&nbsp;&nbsp;&nbsp;
  /* Calculate absolute values with vector operation */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>45&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; abs_params.size/4; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>46&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vpat = spu_cmpgt(vin[i], vzero);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>47&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vin_negative = spu_mul(vin[i], vminus);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vout[i] = spu_sel(vin_negative, vin[i], vpat);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99FF99'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>49&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 3 : PUT output data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(vout, mfc_ea2h(abs_params.ea_out), mfc_ea2l(abs_params.ea_out),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>53&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params.size * sizeof(float), tag, MFC_PUT_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>54&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>55&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>56 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>57&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>58 }</span></p>
  <p class=MsoNormal style='margin-right:18.0pt;layout-grid-mode:char'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 45</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>49</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  calculate absolute values by SPU SIMD operations.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US><a
href="src/example3_3/">Click here for the source code for absolute value
calculations by SPU SIMD operations. </a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Ref150935430"></a><a
name="_Toc188185543"></a><a name="_Toc154400417"></a><a name="_Ref153377602"></a><a
name="_Ref150935552"></a><span lang=EN-US>3.5</span><span lang=EN-US
style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Parallel Programming Using Multiple SPEs</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>All sample
programs presented so far in this chapter run on a single SPE. </span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Finally, we will
now take a look at the method to execute an application using multiple SPEs.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.5.1</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Data Partitioning</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>With Cell
programming, how the work is partitioned among available SPEs is an important
consideration. Although there are many ways of doing this, the following
explanation is based on a model that subdivides data to enable concurrent
processing. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The
data-partitioning application model parallels the same program across multiple
SPEs. Data is partitioned by the PPE program and uniformly distributed to SPEs.
Fig. 3.6 provides an image of this approach. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=479 height=327 src="CellProgrammingTutorial.files/image041.jpg"></span></p>

<p class=MsoCaption align=center style='text-align:center'><a
name="_Ref153190750"><span lang=EN-US>Fig. </span></a><span lang=EN-US>3.6 :
Data Partitioning for Parallel Processing</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Programming is
performed as follows. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.5.2</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Absolute Value Calculation Using Multiple SPEs</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Again, let’s use
the example of absolute value calculation. In Sections 3.3 and 3.4, negative
integers contained in the 64 data inputs are converted into positive integers
by the SPE program running on a single SPE. In Fig. 3.7, the same operation is
performed by four SPEs operating in parallel to process uniformly distributed
data. </span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><span
lang=EN-US><img border=0 width=435 height=286
src="CellProgrammingTutorial.files/image042.jpg"></span></p>

<p class=MsoCaption align=center style='text-align:center'><a
name="_Ref154400552"></a><a name="_Ref154400549"></a><span lang=EN-US>Fig. </span><span
lang=EN-US>3.7: Program Execution by Four SPEs</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The PPE program
executes the SPE program in basically the same manner as when a single SPE is
used, except that multiple SPE contexts must be created and run in parallel.
Since the <b>spe_context_run()</b> function used by the PPE program to execute
the SPE program does not return until the SPE program terminates, it is
necessary to use a thread library to allow multi-SPE parallelization. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The SPE program
is executed as follows when N SPEs are used. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Open the SPE program image.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:red'>(Multi-SPE compliant)</span></b><span
lang=EN-US> Create N SPE contexts.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:red'>(Multi-SPE compliant)</span></b><span
lang=EN-US> Load the SPE program into N LS memories.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(4)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:red'>(Multi-SPE compliant)</span></b><span
lang=EN-US> Create N threads for running the SPE program.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(5)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:red'>(Multi-SPE compliant)</span></b><span
lang=EN-US> Execute the SPE program on each thread.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(6)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:red'>(Multi-SPE compliant)</span></b><span
lang=EN-US> Wait for the threads to terminate.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(7)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><b><span lang=EN-US style='color:red'>(Multi-SPE compliant)</span></b><span
lang=EN-US> Destroy all SPE contexts.</span></p>

<p class=MsoNormal style='margin-left:54.0pt;text-indent:-54.0pt'><span
lang=EN-US>(8)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Close the SPE program image.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Steps (1) and
(8) only need to be called once. This is because the same SPE program image is
used for all SPEs with the data-partitioning application model. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Creating SPE contexts and loading the SPE program</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In multi-SPE
applications, SPE contexts are created individually for all SPEs used. Then the
SPE program is loaded into the LS of each SPE, using the same program image for
all SPEs. List (3-7) shows an example of programming for these operations. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-7): Creating SPE contexts and
loading the SPE program</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='background:#CCFFFF;border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 for (i = 0; i &lt;
  NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;
  spe[i] = spe_context_create(0, NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;
  if (!spe[i]) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_program_load(spe[i], prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_program_load&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Partitioning data for use by the SPE program </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Before running
the SPE program, data must be partitioned for distribution to each SPE. The way
this is done varies from one application to another. List (3-8) demonstrates
one example of programming for partitioning data for absolute value
calculations. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-8): Partitioning data for use by
the SPE program</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>1 int size = SIZE/NUM_SPE;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>2 for (i = 0; i &lt;
  NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>3&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params[i].ea_in&nbsp; = (unsigned long) &amp;in[i*size];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>4&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params[i].ea_out = (unsigned long) &amp;out[i*size];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>5&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params[i].size&nbsp;&nbsp; = size;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>6 }</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>With the example
shown here, 64 data inputs for absolute value calculations are partitioned,
with the effective addresses and size of the input <i>in</i> and output buffer <i>out</i>
appropriately set for each partitioned data, and stored in the main memory as
the parameter set <i>abs_params</i> to be passed to the SPE program.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Creating threads for running the SPE program</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Next, threads
must be created to run the SPE program simultaneously on different SPEs. The
thread library adopted in this tutorial is based on the POSIX threads
(pthread). Threading uses the <b>pthread_create()</b> function. List (3-9)
shows an example of thread programming. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-9): Creating threads for running
the SPE program </span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 for (i = 0; i &lt;
  NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;
  arg[i].spe = spe[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;
  arg[i].abs_params = &amp;abs_params[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;
  ret = pthread_create(&amp;thread[i], NULL, run_abs_spe, &amp;arg[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;pthread_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;
  &nbsp;}</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>To the third
argument of the <b>pthread_create()</b> function, specify the function pointer
to the thread start function. To the fourth, specify the argument to be passed
to the thread start function. The<b> run_abs_spe()</b> function is executed on
the created threads, with the pointer to the variable <i>arg[i]</i> used as its
sole argument.&nbsp; The variable <i>arg[i]</i> must be set to include the
parameters (SPE contexts and partitioned data) necessary for the execution of
the SPE program. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(4)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Concurrently running the SPE program </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Each created
thread calls the <b>spe_context_run()</b> function within the thread start
function to run the SPE program. The SPE program runs in exactly the same way
in both single-SPE and multithreaded applications. List (3-10) shows an example
of programming that allows multitasking within the SPE program. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-10): Concurrently running the SPE
program</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 void
  *run_abs_spe(void *thread_arg)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;
  thread_arg_t *arg = (thread_arg_t *) thread_arg;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int entry;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;
  spe_stop_info_t stop_info;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;
  entry = SPE_DEFAULT_ENTRY;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_run(arg-&gt;spe, &amp;entry, 0, arg-&gt;abs_params, NULL,
  &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret &lt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_run&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  return NULL;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15&nbsp;&nbsp;&nbsp;&nbsp;
  return NULL;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>When the SPE
program terminates, the <b>spe_context_run()</b> function returns control to
individual threads, causing them to terminate <span style='color:#333333'>autonomously</span>.
</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt'><span
lang=EN-US>(5)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;
</span><span lang=EN-US>Terminating threads and destroying SPE contexts</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The <b>pthread_join()</b>
function makes it possible to wait for all threads to terminate. SPE contexts
that are no longer necessary are destroyed. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>List (3-11): Terminating threads and
destroying SPE contexts</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>1 for (i = 0; i &lt;
  NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>2&nbsp;&nbsp;&nbsp;&nbsp;
  pthread_join(thread[i], NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>3&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_destroy(spe[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>4&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_destroy&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>7&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>8 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h3 style='margin-left:82.35pt;text-indent:-82.35pt'><span lang=EN-US>3.5.3</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp; </span><span
lang=EN-US>Sample Program</span></h3>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span style='left:0px;position:
absolute;z-index:2'><span lang=EN-US><img border=0 width=2 height=2
src="CellProgrammingTutorial.files/image040.gif">The following illustrates the
entire source code you need to write for the PPE to enable absolute value
calculations using multiple SPEs. The SPE program is not presented because it
is no different from Sample Program (3-5). </span></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Sample Program (3-6): Absolute value
calculation program using multiple SPEs (PPE program)</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 2 #include
  &lt;stdlib.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 3 #include
  &lt;libspe2.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 4 #include
  &lt;pthread.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 5 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 6 #define NUM_SPE 4</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 7 #define
  SIZE&nbsp;&nbsp;&nbsp; (64)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 8 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 9 float
  in[SIZE]&nbsp; __attribute__((aligned(16))) = {&nbsp; 1,&nbsp; -2,&nbsp;
  3,&nbsp; -4,&nbsp; 5,&nbsp; -6,&nbsp; 7,&nbsp; -8,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  9, -10, 11, -12, 13, -14, 15, -16,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17, -18, 19, -20, 21, -22, 23, -24,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  25, -26, 27, -28, 29, -30, 31, -32,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  33, -34, 35, -36, 37, -38, 39, -40,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;41,
  -42, 43, -44, 45, -46, 47, -48,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  49, -50, 51, -52, 53, -54, 55, -56,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  57, -58, 59, -60, 61, -62, 63, -64 };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;17 float out[SIZE]
  __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;18 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;19 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_in;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_out;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; size;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;23&nbsp;&nbsp;&nbsp;&nbsp;
  int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pad[3];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;24 } abs_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;25 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;26 abs_params_t
  abs_params[NUM_SPE] __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;27 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;28 typedef
  struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;29&nbsp;&nbsp;&nbsp;&nbsp;
  spe_context_ptr_t&nbsp;&nbsp; spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *abs_params;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;31 }
  thread_arg_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;32 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;33 void
  *run_abs_spe(void *thread_arg)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;34 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;35&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;36&nbsp;&nbsp;&nbsp;&nbsp;
  thread_arg_t *arg = (thread_arg_t *) thread_arg;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;37&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int entry;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;38&nbsp;&nbsp;&nbsp;&nbsp;
  spe_stop_info_t stop_info;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;39 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;
  entry = SPE_DEFAULT_ENTRY;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;41&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_run(arg-&gt;spe, &amp;entry, 0, arg-&gt;abs_params, NULL,
  &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret &lt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;43&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_run&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  return NULL;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;45&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;46 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;47&nbsp;&nbsp;&nbsp;&nbsp;
  return NULL;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;48 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;49 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;50 int main(int argc,
  char **argv)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;51 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;52&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;53&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;54 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;55&nbsp;&nbsp;&nbsp;&nbsp;
  spe_program_handle_t *prog;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;56&nbsp;&nbsp;&nbsp;&nbsp;
  spe_context_ptr_t spe[NUM_SPE];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;57&nbsp;&nbsp;&nbsp;&nbsp;
  pthread_t thread[NUM_SPE];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;58&nbsp;&nbsp;&nbsp;&nbsp;
  thread_arg_t arg[NUM_SPE];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;59 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;
  prog = spe_image_open(&quot;vec_abs_spe.elf&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;61&nbsp;&nbsp;&nbsp;&nbsp;
  if (!prog) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;62&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_open&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;63&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;64&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;65 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;66&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;67&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;spe[i] = spe_context_create(0, NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;68&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (!spe[i]) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;69&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;72 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;73&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_program_load(spe[i], prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;74&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;75&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_program_load&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;76&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;77&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;78&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;79 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;
  int size = SIZE/NUM_SPE;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;81&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;82&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params[i].ea_in&nbsp; = (unsigned long) &amp;in[i*size];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;83&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params[i].ea_out = (unsigned long) &amp;out[i*size];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;84&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  abs_params[i].size&nbsp;&nbsp; = size;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;85 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  arg[i].spe = spe[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;87&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  arg[i].abs_params = &amp;abs_params[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;88 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;89&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ret = pthread_create(&amp;thread[i], NULL, run_abs_spe, &amp;arg[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;91&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;pthread_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;92&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;93&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;94&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;95 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;97&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pthread_join(thread[i], NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;98&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_destroy(spe[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;99&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;perror(&quot;spe_context_destroy&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char;background:#99CCFF'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>103&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>104 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>105&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_image_close(prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>106&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>107&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_close&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>108&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>109&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>110 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>111&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; SIZE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>112&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;out[%02d]=%0.0f¥n&quot;, i, out[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>113&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>114 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>115&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>116 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 28</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>31</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>Used to define the data type <i>thread_arg_t</i>
  necessary for passing data to the threads for running the SPE program. The
  structure member <i>spe</i> holds SPE contexts, while the structure member <i>abs_params</i>
  retains the pointer to the parameter set that should be passed to the SPE
  program. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 32</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>44</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>Used to run the SPE program for absolute value
  calculations on each created thread. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 66</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>78</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>Used to create the four SPE contexts required for
  simultaneous SPE program execution on four SPEs. Also used to load the SPE
  program to the LS of each SPE.</span><span lang=EN-US> </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 80</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>94</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>Used to allow data partitioning for multi-SPE
  parallelization. </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='color:black'>The <b>pthread_create() </b>function creates threads for
  running the SPE program, using partitioned data and SPE contexts as
  arguments. </span></p>
  </td>
 </tr>
 <tr>
  <td width=151 valign=top style='width:113.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 96</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>103</span></p>
  </td>
  <td width=543 valign=top style='width:407.1pt;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
  capitalize on the <b>pthread_join()</b> function to wait for the termination
  of threads. Also used to destroy SPE contexts. </span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US><a
href="src/example3_4/">Click here for the source code for multi-SPE absolute
value calculations. </a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Ref151233562"></a><a
name="_Toc188185544"></a><a name="_Toc154400418"></a><a name="_Ref151233573"></a><span
lang=EN-US>3.6</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Exercise (3-1): Parameter Display Program</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Here is a review
question about what we’ve learned in Section 3.2.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Question</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Write a
  program that causes a constant value to be passed from the PPE program to the
  SPE program for printing by the SPE program. The value should be an unsigned
  integer. It should also be passed in the form of a parameter.&nbsp; </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Strategy to Obtain the Answer</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The key to
  answering this question lies in your understanding of how to execute the SPE
  program.</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Refer to
  Section 3.2 if you find it necessary to go over it again.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>A model solution
is provided below, together with some relevant comments. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Solution Program (3-1)</span><span style='font-family:"ＭＳ 明朝"'>】</span><span
  lang=EN-US> (PPE Program)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include
  &lt;stdlib.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 #include
  &lt;libspe2.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 int main(int argc,
  char **argv)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;
  spe_context_ptr_t spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10&nbsp;&nbsp;&nbsp;&nbsp;
  spe_program_handle_t *prog;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int entry;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12&nbsp;&nbsp;&nbsp;&nbsp;
  spe_stop_info_t stop_info;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long param;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16&nbsp;&nbsp;&nbsp;&nbsp;
  prog = spe_image_open(&quot;print_param_spe.elf&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17&nbsp;&nbsp;&nbsp;&nbsp;
  if (!prog) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_open&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22&nbsp;&nbsp;&nbsp;&nbsp;
  spe = spe_context_create(0, NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23&nbsp;&nbsp;&nbsp;&nbsp;
  if (!spe) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>27</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>28&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_program_load(spe, prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_program_load&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>31&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>32&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>33</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>34&nbsp;&nbsp;&nbsp;&nbsp;
  param = 12345678;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35&nbsp;&nbsp;
  &nbsp;&nbsp;printf(&quot;[PPE] param=%ld¥n&quot;, param);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>37&nbsp;&nbsp;&nbsp;&nbsp;
  entry = SPE_DEFAULT_ENTRY;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>38&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_run(spe, &amp;entry, 0, (void *) param, NULL,
  &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>39&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret &lt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_run&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>41&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>42&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>43</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_destroy(spe);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>45&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>46&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_destroy&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>47&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>48&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>49</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_image_close(prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_close&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>53&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>54&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>55</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>56&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>57 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFCC;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Solution Program (3-1)</span><span style='font-family:"ＭＳ 明朝"'>】</span><span
  lang=EN-US> (SPE Program)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>1 #include &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>2</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>3 int main(unsigned long
  long spe, unsigned long long argp, unsigned long long envp)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>4 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>5&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;[SPE] param=%lld¥n&quot;, argp);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>6</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>7&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>8 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a href="src/practice3_1_a/">Click here for
the source code for Solution Program (3-1).</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=693
 style='width:520.1pt;border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Program Description</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>It’s not difficult
  to answer this question if you are familiar with the use of the arguments of
  the <b>spe_context_run()</b> function. </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Although DMA
  transfer is available for data and parameter passing between the PPE and SPE programs,
  we’d like you to use a simpler method of passing the parameter to the
  argument of the SPE program’s <b>main()</b> function. In the program
  suggested above, the parameter is passed to the second argument <i>argp </i>of
  the SPE program’s <b>main()</b> function by specifying it to the fourth
  argument <i>argp</i> of the <b>spe_context_run() </b>function.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>A brief
  description of the source code follows.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(PPE Program)</span></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 34</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    assign a value to the parameter variable <i>param</i> for passing to the
    SPE program.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 38</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    specify the variable <i>param</i> to the fourth argument <i>argp</i> of the<b>
    spe_context_run()</b> function. Also used to allow typecasting to <i>void *</i>
    according to the prototype declaration. </span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(SPE Program)</span></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 5</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    output the parameter passed to the second argument <i>argp</i> of the <b>main()
    </b>function to the standard output. </span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>　</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Toc148010408"></a><a
name="_Toc188185545"></a><a name="_Toc154400419"></a><a name="_Ref151233613"></a><a
name="_Ref151233608"></a><a name="_Ref151233601"></a><a name="_Toc148010751"></a><span
lang=EN-US>3.7</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Exercise </span><span lang=EN-US>(3-2): Case Conversion
Program</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Here is a review
question about what we’ve learned in Sections 3.3 and 3.4.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Question</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Practice Program
  (3-2) shows a program that converts lower-case characters (a</span><span
  style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>z) into uppercase
  characters (A</span><span style='font-family:"ＭＳ 明朝"'>〜</span><span
  lang=EN-US>Z). Rewrite it into an SPE program that performs SIMD operations. </span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The character
  string (“A Quick Brown Fox Jumps Over The Lazy Dog.”) to be subject to conversion
  processing by the SPE program is transferred by DMA from the PPE program.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Practice Program(3-2)</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 #define
  LENGTH&nbsp; (48)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 char in[LENGTH] =
  &quot;A Quick Brown Fox Jumps Over The Lazy Dog.¥0&quot;;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6 char out[LENGTH];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8 int main(int argc,
  char **argv)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;
  char offset = 'a' - 'A';</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; sizeof(in); i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (in[i] &gt;= 'a' &amp;&amp; in[i] &lt;= 'z') {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  out[i] = in[i] - offset;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  } else {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  out[i] = in[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;in &nbsp;= %s¥n&quot;, in);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;out = %s¥n&quot;, out);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:char;
  word-break:break-all'><span lang=EN-US><a href="src/practice3_2_q/">Click
  here for the source code for Practice Question (3-2)</a>.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Strategy to Obtain the Answer</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The key to
  answering this question lies in your understanding of how to program DMA
  transfer. </span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Refer to
  Section 3.3 to go over it again.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The <b>spu_cmpeq()</b>
  and <b>spu_cmpgt()</b> functions listed in Table 3.2 are the only intrinsics
  available for&nbsp; compare instructions applicable to SPU SIMD operations.
  No intrinsics existfor operators such as &gt;= and &lt;=. Please try to
  uncover your answer by clever use of the available intrinsics. &nbsp;</span></p>
  <p class=MsoNormal><span lang=EN-US style='color:blue'>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>ASCII Code is
  a character set that uses seven bits per character. As shown in Table 3.3,
  lower to upper case conversion of alphabetic letters can be performed by
  applying a specific offset value (0x20).</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoCaption align=center style='text-align:center;page-break-after:
  avoid'><a name="_Ref153362329"></a><a name="_Ref153362290"></a><span
  lang=EN-US>Table </span><span lang=EN-US>3.3:&nbsp; ASCII Code Chart</span></p>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
  border=0 width=398 height=282 src="CellProgrammingTutorial.files/image043.jpg"></span></p>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><a name="_Toc148010409"></a><a name="_Toc148010752"></a><span
lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>A model solution
is provided below, together with some relevant comments. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=727
 style='width:545.4pt;border-collapse:collapse'>
 <tr>
  <td width=727 valign=top style='width:545.4pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Solution Program(3-2)</span><span style='font-family:"ＭＳ 明朝"'>】</span>
  <span lang=EN-US>(PPE Program)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include
  &lt;stdlib.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 #include
  &lt;libspe2.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 #define
  LENGTH&nbsp; (48)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7 char
  in[LENGTH]&nbsp; __attribute__((aligned(16))) = &quot;A Quick Brown Fox Jumps
  Over The Lazy Dog.¥0&quot;;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8 char out[LENGTH] __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_in;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_out;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13
  &nbsp;&nbsp;&nbsp;&nbsp;unsigned
  int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; size;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14&nbsp;&nbsp;&nbsp;&nbsp;
  int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pad[3];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15 } upper_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17 upper_params_t
  upper_params __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19 int main(int argc, char
  **argv)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23&nbsp;&nbsp;&nbsp;&nbsp;
  spe_context_ptr_t spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;
  spe_program_handle_t *prog;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int entry;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26&nbsp;&nbsp;&nbsp;&nbsp;
  spe_stop_info_t stop_info;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>27</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>28&nbsp;&nbsp;&nbsp;&nbsp;
  prog = spe_image_open(&quot;upper_spe.elf&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29&nbsp;&nbsp;&nbsp;&nbsp;
  if (!prog) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_open&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>31&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>32&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>33</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>34&nbsp;&nbsp;&nbsp;&nbsp;
  spe = spe_context_create(0, NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35&nbsp;&nbsp;&nbsp;&nbsp;
  if (!spe) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>38&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>39</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>40&nbsp;&nbsp;&nbsp;&nbsp; ret
  = spe_program_load(spe, prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>41&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_program_load&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>43&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>45</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>46&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;[PPE] in&nbsp; = %s¥n&quot;, in);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>47</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>48&nbsp;&nbsp;&nbsp;&nbsp;
  upper_params.ea_in&nbsp; = (unsigned long) in;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>49&nbsp;&nbsp;&nbsp;&nbsp; upper_params.ea_out
  = (unsigned long) out;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50&nbsp;&nbsp;&nbsp;&nbsp;
  upper_params.size&nbsp;&nbsp; = LENGTH;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52&nbsp;&nbsp;&nbsp;&nbsp;
  entry = SPE_DEFAULT_ENTRY;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>53&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_run(spe, &amp;entry, 0, &amp;upper_params, NULL,
  &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>54&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret &lt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_run&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>56&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>57&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>58</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>59&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_destroy(spe);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>60&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>61&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_destroy&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>62&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>63&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>64</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>65&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_image_close(prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>66&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>67&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_close&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>68&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>69&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>70</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>71&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;[PPE] out = %s¥n&quot;, out);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>72</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>73&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>74 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFCC;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Solution Program (3-2)</span><span style='font-family:"ＭＳ 明朝"'>】</span><span
  lang=EN-US> (SPE Program)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include
  &lt;spu_intrinsics.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 #include
  &lt;spu_mfcio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 #define MAX_BUFSIZE
  (128)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7 char
  in_spe[MAX_BUFSIZE]&nbsp; __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8 char
  out_spe[MAX_BUFSIZE] __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_in;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_out;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; size;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14&nbsp;&nbsp;&nbsp;&nbsp;
  int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pad[3];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15 } upper_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17 upper_params_t
  upper_params __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19 int main(unsigned long
  long spe, unsigned long long argp, unsigned long long envp)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22&nbsp;&nbsp;&nbsp;&nbsp;
  int tag = 1;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char *vin&nbsp; = (__vector unsigned char *) in_spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char *vout = (__vector unsigned char *) out_spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>27&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vout_upper;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>28&nbsp;&nbsp;&nbsp;
  &nbsp;__vector unsigned char vpat, vpata, vpatz;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char va = spu_splats((unsigned char) 'a');</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>31&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vz = spu_splats((unsigned char) 'z');</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>32&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char voffset = spu_splats((unsigned char) ('a' - 'A'));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>33 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>34&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 1 : GET input/output parameters */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(&amp;upper_params, mfc_ea2h(argp), mfc_ea2l(argp),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  sizeof(upper_params_t), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>37&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>38&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>39 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>40&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 2 : GET input data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>41&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(vin, mfc_ea2h(upper_params.ea_in), mfc_ea2l(upper_params.ea_in),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  upper_params.size, tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>43&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>45 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>46&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;[SPE] in&nbsp; = %s¥n&quot;, in_spe);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>47 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>48&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; upper_params.size/16; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>49&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vpata = spu_cmpgt(va, vin[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vpatz = spu_cmpgt(vin[i], vz);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vpat&nbsp; = spu_or(vpata, vpatz);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vout_upper = (__vector unsigned char)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>53&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  spu_sub((__vector unsigned short) vin[i], (__vector unsigned short) voffset);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>54&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vout[i] = spu_sel(vout_upper, vin[i], vpat);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>55&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>56 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>57&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;[SPE] out = %s¥n&quot;, out_spe);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>58 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>59&nbsp;&nbsp;&nbsp;&nbsp; /*
  DMA Transfer 3 : PUT output data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>60&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(vout, mfc_ea2h(upper_params.ea_out),
  mfc_ea2l(upper_params.ea_out),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>61&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  upper_params.size, tag, MFC_PUT_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>62&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>63&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>64 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>65&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>66 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a href="src/practice3_2_a/">Click here for
the source code for Solution Program (3-2).</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Program Description</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>This problem<span
  style='color:blue'> </span>can be solved in almost the same way as the sample
  question given in Section 3.3.</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The PPE
  program combines the effective addresses of the input data<i> in</i> and
  output buffer <i>out </i>with information about data size in the parameter
  set <i>upper_params</i> and passes the effective address of this parameter
  set to the SPE program. </span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Using the
  effective address passed to the second argument <i>argp </i>of the <b>main()</b>
  function, the SPE program transfers the parameter set <i>upper_params</i> to
  the LS using DMA transfer (GET). Then, the SPE program executes DMA transfer
  (GET) of the input data, performs lower to upper case conversion, and
  transfers the converted characters to the output buffer, again by means of
  DMA transfer (PUT).&nbsp; </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The lower to
  upper case character conversion by SIMD operations calls for substitution of
  the original program by a logically equivalent program that can be expressed
  using the available SPU SIMD intrinsics only. The following shows such
  substitute code that does not require the use of operators &gt;= and &lt;=.</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:144.0pt;layout-grid-mode:char'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>if (‘a’ &gt;
  in[i] || in[i] &gt; ‘z’) {</span></p>
  <p class=MsoNormal style='text-indent:144.0pt;layout-grid-mode:char'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;
  out[i] = in[i];</span></p>
  <p class=MsoNormal style='text-indent:144.0pt;layout-grid-mode:char'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>} else {</span></p>
  <p class=MsoNormal style='text-indent:144.0pt;layout-grid-mode:char'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;
  out[i] = in[i] &#8211; offset;</span></p>
  <p class=MsoNormal style='text-indent:144.0pt;layout-grid-mode:char'><span
  lang=EN-US style='font-size:9.0pt;font-family:"Courier New"'>}</span></p>
  <p class=MsoNormal><b><span lang=EN-US>&nbsp;</span></b></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The above
  substitution enables the required character conversion by SIMD operations
  using the <b>spu_cmpgt () </b>and <b>spu_or()</b> functions. The <b>spu_or()</b>
  function is used to find the element-wise logical sum (OR) between two
  vectors. </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>A brief
  description of the source code follows.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(PPE Program)</span></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 10</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>15</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    define the data type <i>upper_params_t </i>of the parameter set to be
    passed to the SPE program. By <i>pad[3]</i>, data is padded into 32 bytes
    for DMA transfer, which requires the data size to be a multiple of 16
    bytes.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 48</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>50</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    set the parameters (effective addresses of scalar arrays <i>in</i> and <i>out</i>,
    plus array size) to be passed to the SPE program.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 53</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    specify the effective address of the parameter set <i>upper_params</i> that
    is passed to the SPE program as the fourth argument of the <b>spe_context_run()</b>
    function.</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(SPE Program)</span></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 35</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>38</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to cause
    DMA transfer to transfer the parameter set <i>upper_params</i> from the
    main memory to the LS.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 41</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>44</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    cause DMA transfer to transfer the input data <i>in</i> from the effective
    address of the main memory specified by <i>upper_params.ea_in </i>to the variable
    <i>in_spe</i>.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 48</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>55</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    convert lower case characters into uppercase characters, as well as to
    store them in the variable <i>out_spe</i>.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 60</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>63</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    cause DMA transfer to transfer data in the variable <i>out_spe</i> to the
    output buffer <i>out</i> specified by <i>upper_params.ea_out</i>. </span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>　</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Ref151233619"></a><a
name="_Toc188185546"></a><a name="_Toc154400420"></a><a name="_Ref151233622"></a><span
lang=EN-US>3.8</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Exercise (3-3): Sectional Measurement Program</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Here is a review
question about what we’ve learned in Sections 3.4 and 3.5.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"MS 明朝"'>【</span><span
  lang=EN-US>Question</span><span style='font-family:"MS 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Practice Program
  (3-3) is used to calculate the approximate dimensions of the area shaded in
  green in Fig. 3.8. Rewrite this program so that the calculation can be
  performed on multiple SPEs. </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal align=center style='text-align:center;text-indent:10.5pt;
  page-break-after:avoid'><span lang=EN-US><img border=0 width=250 height=195
  src="CellProgrammingTutorial.files/image044.jpg"></span></p>
  <p class=MsoCaption align=center style='text-align:center'><a
  name="_Ref153266161"></a><a name="_Ref153266153"></a><span lang=EN-US>Fig. </span><span
  lang=EN-US>3.8: Area for Calculation</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt;layout-grid-mode:char'><span
  lang=EN-US>The dimensions of the shaded area can be expressed by the interval
  [0, 4] of the graph <sub><span style='position:relative;top:5pt'><img
  border=0 width=61 height=21 src="CellProgrammingTutorial.files/image045.gif"></sub></span>,
  while the function <sub><span style='position:relative;top:5pt'><img
  border=0 width=36 height=21 src="CellProgrammingTutorial.files/image046.gif"></sub></span>&nbsp;can
  be calculated by the following formula.</span></p>
  <p class=MsoNormal style='text-indent:10.5pt;layout-grid-mode:char'><span
  lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal align=center style='text-align:center;text-indent:10.5pt;
  layout-grid-mode:char'><sub><span lang=EN-US><span style='position:relative;
  top:5pt'><img border=0 width=241 height=24
  src="CellProgrammingTutorial.files/image047.gif"></span></sub><span
  lang=EN-US></span></span></p>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>　</span></p>
  <p class=MsoNormal style='text-indent:10.5pt;layout-grid-mode:char'><span
  lang=EN-US>As illustrated in Fig. 3.9, this program capitalizes on the
  quadrature method that calculates the sum of areas (<sub><span
  style='position:relative;top:5pt'><img border=0 width=63 height=21
  src="CellProgrammingTutorial.files/image048.gif"></sub></span>) of individual
  rectangles obtained by dividing the interval by <i>n</i>. The <b>func()</b>
  function allows calculation of the value of the function <sub><span
  style='position:relative;top:5pt'><img border=0 width=36 height=21
  src="CellProgrammingTutorial.files/image046.gif"></sub></span>. The <b>calc_integral()</b>
  function is used to calculate the sum.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal align=center style='text-align:center;page-break-after:
  avoid'><span lang=EN-US><img border=0 width=300 height=203
  src="CellProgrammingTutorial.files/image049.jpg"></span></p>
  <p class=MsoCaption align=center style='text-align:center'><a
  name="_Ref153268991"><span lang=EN-US>Fig. </span></a><span lang=EN-US>3.9:
  Quadrature by Parts</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt;layout-grid-mode:char'><span
  lang=EN-US>In addition, the function<sub><span style='position:relative;
  top:5pt'><img border=0 width=36 height=21
  src="CellProgrammingTutorial.files/image046.gif"></sub></span>&nbsp;can be
  expressed as follows to make it appropriate for SIMD operations using the <b>vec_madd()</b>
  function. </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal align=center style='text-align:center;text-indent:10.5pt;
  layout-grid-mode:char'><sub><span lang=EN-US><span style='position:relative;
  top:5pt'><img border=0 width=253 height=21
  src="CellProgrammingTutorial.files/image050.gif"></span></sub><span
  lang=EN-US></span></span></p>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Practice Program (3-3)</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include
  &lt;altivec.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4 __vector float
  func(__vector float vx)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vy;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float va = (__vector float) {&nbsp;&nbsp; 5.0f,&nbsp;&nbsp;
  5.0f,&nbsp;&nbsp; 5.0f,&nbsp;&nbsp; 5.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vb = (__vector float) { -16.0f, -16.0f, -16.0f, -16.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vc = (__vector float) { -36.0f, -36.0f, -36.0f, -36.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vd = (__vector float) {&nbsp; 64.0f,&nbsp; 64.0f,&nbsp;
  64.0f,&nbsp; 64.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float ve = (__vector float) { 192.0f, 192.0f, 192.0f, 192.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13&nbsp;&nbsp;&nbsp;&nbsp;
  vy = vec_madd(va, vx, vb);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14&nbsp;&nbsp;&nbsp;&nbsp;
  vy = vec_madd(vy, vx, vc);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15&nbsp;&nbsp;&nbsp;&nbsp;
  vy = vec_madd(vy, vx, vd);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16&nbsp;&nbsp;&nbsp;&nbsp;
  vy = vec_madd(vy, vx, ve);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18&nbsp;&nbsp;&nbsp;&nbsp;
  return vy;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21 float
  calc_integral(float start, float end, float delta)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;
  float *sum;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vx&nbsp;&nbsp;&nbsp;&nbsp; = (__vector float) { start+delta*0,
  start+delta*1,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>27&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  start+delta*2, start+delta*3 };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>28&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vsum&nbsp;&nbsp; = (__vector float) { 0.0f, 0.0f, 0.0f, 0.0f
  };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vdelta = (__vector float) { delta, delta, delta, delta };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vstep&nbsp; = (__vector float) { 4.0f, 4.0f, 4.0f, 4.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>31 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>32&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; (end-start)/delta; i += 4) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>33&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vsum = vec_madd(func(vx), vdelta, vsum);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>34&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vx&nbsp;&nbsp; = vec_madd(vdelta, vstep, vx);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>37&nbsp;&nbsp;&nbsp;&nbsp;
  sum = (float *) &amp;vsum;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>38 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>39&nbsp;&nbsp;&nbsp;&nbsp;
  return (sum[0] + sum[1] + sum[2] + sum[3]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>40 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>41 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>42 int main(int argc, char
  **argv)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>43 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44&nbsp;&nbsp;&nbsp;&nbsp;
  float start = 0.0f;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>45&nbsp;&nbsp;&nbsp;&nbsp;
  float end&nbsp;&nbsp; = 4.0f;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>46&nbsp;&nbsp;&nbsp;&nbsp;
  float delta = 0.00001f;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>47&nbsp;&nbsp;&nbsp;&nbsp;
  float result;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>48 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>49&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;start = %f, end = %f¥n&quot;, start, end);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51&nbsp;&nbsp;&nbsp;&nbsp;
  result = calc_integral(start, end, delta);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>53&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;result = %f¥n&quot;, result);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>54 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>55&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>56 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:char'><span
  lang=EN-US><a href="src/practice3_3_q/">Click here for the source code for Practice
  Question (3-3).</a></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Strategy to Obtain the Answer</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The key to
  answering this question lies in your understanding of how to partition
  application processing for execution on multiple SPEs.&nbsp; </span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Refer to
  Section 3.5 to go over it again.</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In addition,
  write your program so that the SPE program can be run by the <b>calc_integral()</b>
  function. Do not rewrite the <b>main() </b>function of the PPE program. </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:8.9pt'><span lang=EN-US>A model solution
is provided below, together with some relevant comments.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span style='font-family:
  "ＭＳ 明朝"'>【</span><span lang=EN-US>Solution Program (3-3)</span><span
  style='font-family:"ＭＳ 明朝"'>】</span><span lang=EN-US> (PPE Program)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 2 #include
  &lt;stdlib.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 3 #include
  &lt;libspe2.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 4 #include
  &lt;pthread.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 5</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 6 #define NUM_SPE 4</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 7</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 8 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;
  9&nbsp;&nbsp;&nbsp;&nbsp; float&nbsp;&nbsp; start;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;
  float&nbsp;&nbsp; end;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;
  float&nbsp;&nbsp; delta;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp;
  float&nbsp;&nbsp; sum;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;13 }
  integral_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;14</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;15 integral_params_t
  integral_params[NUM_SPE] __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;16</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;17 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;
  spe_context_ptr_t spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;19&nbsp;&nbsp;&nbsp;&nbsp;
  integral_params_t *integral_params;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;20 } thread_arg_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;21</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;22 void *run_integral_spe(void
  *thread_arg)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;23 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;24&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;25&nbsp;&nbsp;&nbsp;&nbsp;
  thread_arg_t *arg = (thread_arg_t *) thread_arg;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;26&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int entry;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;27&nbsp;&nbsp;&nbsp;&nbsp;
  spe_stop_info_t stop_info;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;28</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;29&nbsp;&nbsp;&nbsp;&nbsp;
  entry = SPE_DEFAULT_ENTRY;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_run(arg-&gt;spe, &amp;entry, 0, arg-&gt;integral_params,
  NULL, &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;31&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret &lt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_run&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  return NULL;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;34&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;35</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;36&nbsp;&nbsp;&nbsp;&nbsp;
  return NULL;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;37 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;38</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;39 float
  calc_integral(float start, float end, float delta)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;40 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;41&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;43&nbsp;&nbsp;&nbsp;&nbsp;
  float sum = 0.0f;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;44</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;45&nbsp;&nbsp;&nbsp;&nbsp;
  spe_program_handle_t *prog;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;46&nbsp;&nbsp;&nbsp;&nbsp;
  spe_context_ptr_t spe[NUM_SPE];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;47&nbsp;&nbsp;&nbsp;&nbsp;
  pthread_t thread[NUM_SPE];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;48&nbsp;&nbsp;&nbsp;&nbsp;
  thread_arg_t arg[NUM_SPE];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;49</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;
  prog = spe_image_open(&quot;integral_spe.elf&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;51&nbsp;&nbsp;&nbsp;&nbsp;
  if (!prog) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;52&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;spe_image_open&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;53&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;54&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;55</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;56&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;57&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  spe[i] = spe_context_create(0, NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;58&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (!spe) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;59&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;61&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;62</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;63&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_program_load(spe[i], prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;65&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_program_load&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;66&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;67&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;68&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;69</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  integral_params[i].start = start + (end-start)/NUM_SPE * i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;72&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  integral_params[i].end&nbsp;&nbsp; = start + (end-start)/NUM_SPE * (i+1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;73&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  integral_params[i].delta = delta;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;74&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  integral_params[i].sum&nbsp;&nbsp; = 0.0f;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;75</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;76&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  arg[i].spe = spe[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;77&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  arg[i].integral_params = &amp;integral_params[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;78</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;79&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ret = pthread_create(&amp;thread[i], NULL, run_integral_spe, &amp;arg[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;81&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;pthread_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;82&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;83&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;84&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;85</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;86&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;87&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pthread_join(thread[i], NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;88&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_destroy(spe[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;89&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_destroy&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;91&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;92&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;93&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;94</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;95&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_image_close(prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;97&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_close&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;98&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;99&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>100</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>101&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;[PPE] sum = %f¥n&quot;, integral_params[i].sum);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>103&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  sum += integral_params[i].sum;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>104&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>105</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>106&nbsp;&nbsp;&nbsp;&nbsp;
  return sum;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>107 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>108</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>109 int main(int argc, char
  **argv)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>110 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>111&nbsp;&nbsp;&nbsp;&nbsp;
  float start = 0.0f;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>112&nbsp;&nbsp;&nbsp;&nbsp;
  float end&nbsp;&nbsp; = 4.0f;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>113&nbsp;&nbsp;&nbsp;&nbsp;
  float delta = 0.00001f;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>114&nbsp;&nbsp;&nbsp;&nbsp;
  float result;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>115</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>116&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;[PPE] start = %f, end = %f¥n&quot;, start, end);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>117</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>118&nbsp;&nbsp;&nbsp;&nbsp;
  result = calc_integral(start, end, delta);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>119</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>120&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;[PPE] result = %f¥n&quot;, result);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>121</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>122&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>123 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFCC;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span style='font-family:
  "ＭＳ 明朝"'>【</span><span lang=EN-US>Solution Program (3-3)</span><span
  style='font-family:"ＭＳ 明朝"'>】</span><span lang=EN-US> (SPE Program)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include
  &lt;spu_intrinsics.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 #include
  &lt;spu_mfcio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;
  float&nbsp;&nbsp; start;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;
  float&nbsp;&nbsp; end;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;
  float&nbsp;&nbsp; delta;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;
  float&nbsp;&nbsp; sum;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10 } integral_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12 integral_params_t
  integral_params __attribute__((aligned(16)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14 __vector float
  func(__vector float vx)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vy;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float va = (__vector float) {&nbsp;&nbsp; 5.0f,&nbsp;&nbsp;
  5.0f,&nbsp;&nbsp; 5.0f,&nbsp;&nbsp; 5.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vb = (__vector float) { -16.0f, -16.0f, -16.0f, -16.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vc = (__vector float) { -36.0f, -36.0f, -36.0f, -36.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vd = (__vector float) {&nbsp; 64.0f,&nbsp; 64.0f,&nbsp;
  64.0f,&nbsp; 64.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float ve = (__vector float) { 192.0f, 192.0f, 192.0f, 192.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23&nbsp;&nbsp;&nbsp;&nbsp;
  vy = spu_madd(va, vx, vb);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;
  vy = spu_madd(vy, vx, vc);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25&nbsp;
  &nbsp;&nbsp;&nbsp;vy = spu_madd(vy, vx, vd);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26&nbsp;&nbsp;&nbsp;&nbsp;
  vy = spu_madd(vy, vx, ve);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>27 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>28&nbsp;&nbsp;&nbsp;&nbsp;
  return vy;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>31 float
  calc_integral(float start, float end, float delta)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>32 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>33&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>34&nbsp;&nbsp;&nbsp;&nbsp; float
  *sum;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vx&nbsp;&nbsp;&nbsp;&nbsp; = (__vector float) { start+delta*0,
  start+delta*1,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  start+delta*2, start+delta*3 };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>38&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vsum&nbsp;&nbsp; = (__vector float) { 0.0f, 0.0f, 0.0f, 0.0f
  };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>39&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vdelta = (__vector float) { delta, delta, delta, delta };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>40&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vstep&nbsp; = (__vector float) { 4.0f, 4.0f, 4.0f, 4.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>41 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>42&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; (end-start)/delta; i += 4) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>43&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vsum = spu_madd(func(vx), vdelta, vsum);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vx&nbsp;&nbsp; = spu_madd(vdelta, vstep, vx);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>45&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>46 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>47&nbsp;&nbsp;&nbsp;&nbsp;
  sum = (float *) &amp;vsum;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>48 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>49&nbsp;&nbsp;&nbsp;&nbsp;
  return (sum[0] + sum[1] + sum[2] + sum[3]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52 int main(unsigned long
  long spe, unsigned long long argp, unsigned long long envp)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>53 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>54&nbsp;&nbsp;&nbsp;&nbsp;
  int tag = 1;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>55 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>56&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 1 : GET input/output parameters */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>57&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(&amp;integral_params, mfc_ea2h(argp), mfc_ea2l(argp),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>58&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  sizeof(integral_params_t), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>59&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>60&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>61 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>62&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;[SPE] start = %f, end = %f¥n&quot;, integral_params.start,
  integral_params.end);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>63 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>64&nbsp;&nbsp;&nbsp;&nbsp;
  integral_params.sum = calc_integral(integral_params.start,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>65&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  integral_params.end,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>66&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  integral_params.delta);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>67 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>68&nbsp;&nbsp;&nbsp;&nbsp;
  printf(&quot;[SPE] sum = %f¥n&quot;, integral_params.sum);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>69 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>70&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 2 : PUT output data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>71&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(&amp;integral_params, mfc_ea2h(argp), mfc_ea2l(argp),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>72&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  sizeof(integral_params_t), tag, MFC_PUT_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>73
  &nbsp;&nbsp;&nbsp;&nbsp;spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>74&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>75 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>76&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>77 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a href="src/practice3_3_a/">Click here for
the source code for Solution Program (3-3).</a></span></p>

<p class=MsoNormal align=left style='text-align:left'><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Program Description</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>These programs
  allow sectional measurement calculations by concurrently operating four SPEs.
  Data partitioning is enabled by dividing the interval of the relevant area as
  shown in Fig. 3.10.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal align=center style='text-align:center;page-break-after:
  avoid'><span lang=EN-US><img border=0 width=300 height=232
  src="CellProgrammingTutorial.files/image051.jpg"></span></p>
  <p class=MsoCaption align=center style='text-align:center'><a
  name="_Ref154226621"><span lang=EN-US>Fig. </span></a><span lang=EN-US>3.10:
  Data Partitioning for Multi-SPE Processing </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Like the sample
  program explained in Section3.5, the above solution programs make use of a
  thread library to allow multi-SPE parallelization. Threads are created after
  creating SPE contexts individually for all SPEs used. With regard to data,
  the interval of the area to be calculated is subdivided in advance as shown
  in Table 3.4. In addition, coordinate information about each divided area is
  set in the parameter set <i>integral_params</i> for passing to the SPE
  program.&nbsp; </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoCaption align=center style='text-align:center;page-break-after:
  avoid'><a name="_Ref154315261"><span lang=EN-US>Table </span></a><span
  lang=EN-US>3.4: Interval Data (Parameter)</span></p>
  <div align=center>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=74 valign=top style='width:55.6pt;border:solid windowtext 1.0pt;
    background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>&nbsp;</span></p>
    </td>
    <td width=82 valign=top style='width:61.8pt;border:solid windowtext 1.0pt;
    border-left:none;background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
    char'><span lang=EN-US>Coordinate</span></p>
    <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
    char'><span lang=EN-US>(<i>start</i>)</span></p>
    </td>
    <td width=82 valign=top style='width:61.8pt;border:solid windowtext 1.0pt;
    border-left:none;background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
    char'><span lang=EN-US>Coordinate</span></p>
    <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
    char'><span lang=EN-US>(<i>end</i>)</span></p>
    </td>
   </tr>
   <tr>
    <td width=74 valign=top style='width:55.6pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>SPE #1</span></p>
    </td>
    <td width=82 valign=top style='width:61.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:
    char'><span lang=EN-US>0.0</span></p>
    </td>
    <td width=82 valign=top style='width:61.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:
    char'><span lang=EN-US>1.0</span></p>
    </td>
   </tr>
   <tr>
    <td width=74 valign=top style='width:55.6pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>SPE #2</span></p>
    </td>
    <td width=82 valign=top style='width:61.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:
    char'><span lang=EN-US>1.0</span></p>
    </td>
    <td width=82 valign=top style='width:61.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:
    char'><span lang=EN-US>2.0</span></p>
    </td>
   </tr>
   <tr>
    <td width=74 valign=top style='width:55.6pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>SPE #3</span></p>
    </td>
    <td width=82 valign=top style='width:61.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:
    char'><span lang=EN-US>2.0</span></p>
    </td>
    <td width=82 valign=top style='width:61.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:
    char'><span lang=EN-US>3.0</span></p>
    </td>
   </tr>
   <tr>
    <td width=74 valign=top style='width:55.6pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>SPE #4</span></p>
    </td>
    <td width=82 valign=top style='width:61.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:
    char'><span lang=EN-US>3.0</span></p>
    </td>
    <td width=82 valign=top style='width:61.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:
    char'><span lang=EN-US>4.0</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The SPE
  program accesses the parameter set <i>integral_params</i> by DMA transfer
  (GET). Each structure member of this parameter set contains input parameters <i>start</i>,
  <i>end</i> and <i>delta</i>, while <i>sum</i> is the output parameter for
  returning the calculated result. </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The <b>func()</b>
  and <b>calc_integral()</b> functions can be obtained simply by substituting
  the original VMX program with the intrinsics of SPU SIMD instructions.&nbsp; </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>A brief
  description of the source code follows.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(PPE Program)</span></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 28</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>31</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
    style='color:black'>Used to define the structure <i>thread_arg_t</i> that
    enables data passing to each thread.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 32</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>44</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>The <b>run_integral_spe()</b>
    function makes the thread start running. Using the parameter set passed to
    its argument, it also runs the SPE program so that calculations can be
    done.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 65</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>77</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
    style='color:black'>Used to create the necessary number of SPE contexts.
    Also used to load the SPE program to the LS.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 80</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>93</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>To
    parallel calculations on four SPEs, used to subdivide the interval of the
    area, as well as to create and pass the subdivision information parameter
    set to the <b>run_integral_spe()</b> function. The <b><span
    style='color:black'>pthread_create()</span></b><span style='color:black'>
    function is used to create new threads. </span></span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 95</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>102</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    wait for the SPE program to complete, using the <b>pthread_join()</b>
    function. When the threads terminate, also used to destroy the SPE
    contexts. </span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(SPE Program)</span></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 14</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>29</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>The <b>func()</b>
    function enables calculation of the function <sub><span style='position:
    relative;top:5pt'><img border=0 width=36 height=21
    src="CellProgrammingTutorial.files/image046.gif"></sub></span>.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 31</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>50</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>The <b>calc_integral()</b>
    function allows area calculation by the quadrature method.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 57</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>60</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    transfer the parameter set <i>integral_params</i> from the main memory to
    the LS by DMA transfer (GET).</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 64</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>66</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    execute the <b>calc_integral()</b> function using the argument that
    provides information about the area to be calculated by each SPE. </span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 71</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>74</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    transfer the parameter set <i>integral_params</i> from the LS to the main
    memory by DMA transfer (PUT). </span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>　</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Toc148010410"></a><a
name="_Toc188185547"></a><a name="_Toc154400421"></a><a name="_Ref151233629"></a><a
name="_Ref151233626"></a><a name="_Toc148010753"></a><span lang=EN-US>3.9</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Exercise (3-4): Grayscale Conversion Program (for
Single SPE)</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>This exercise
can be used as a comprehensive review of what we’ve learned inChapter 3.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Question</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Practice
  Program (3-4) shows the solution program we obtained in Exercise (2-4). </span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>More precisely
  speaking, it displays the <b>rgb2y() </b>function that carries out color to
  grayscale conversion using VMX instructions. </span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Rewrite this
  program so that the same conversion processing can be performed on a single
  SPE. </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr style='height:202.5pt'>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt;height:202.5pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Practice Program(3-4)</span><span style='font-family:"ＭＳ 明朝"'>】</span><span
  lang=EN-US> (Partial Excerpt)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include
  &lt;altivec.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4 void rgb2y(unsigned
  char *src, unsigned char *dst, int num)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char *vsrc = (__vector unsigned char *) src;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char *vdst = (__vector unsigned char *) dst;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned int vr, vg, vb, vy, vpat;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vfr, vfg, vfb, vfy;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vrconst = (__vector float) { 0.29891f, 0.29891f, 0.29891f,
  0.29891f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vgconst = (__vector float) { 0.58661f, 0.58661f, 0.58661f,
  0.58661f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vbconst = (__vector float) { 0.11448f, 0.11448f, 0.11448f,
  0.11448f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vfzero&nbsp; = (__vector float) { 0.0f, 0.0f, 0.0f, 0.0f };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18&nbsp;&nbsp;&nbsp;&nbsp; __vector
  unsigned int vmax = (__vector unsigned int) { 255, 255, 255, 255 };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vpatr = (__vector unsigned char) { 0x10, 0x10, 0x10,
  0x00,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x04,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x08,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x10,
  0x10, 0x10, 0x0c };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vpatg = (__vector unsigned char) { 0x10, 0x10, 0x10,
  0x01,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x05,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x10,
  0x10, 0x10, 0x09,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>27&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x0d };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>28&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vpatb = (__vector unsigned char) { 0x10, 0x10, 0x10,
  0x02,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x10,
  0x10, 0x10, 0x06,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x0a,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>31&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x0e };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>32&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vpaty = (__vector unsigned char) { 0x03, 0x03, 0x03,
  0x10,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>33&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x07, 0x07, 0x07, 0x10,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>34&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x0b, 0x0b, 0x0b, 0x10,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x0f, 0x0f, 0x0f, 0x10 };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vzero = (__vector unsigned char) { 0, 0, 0, 0, 0, 0,
  0, 0,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0, 0, 0, 0, 0, 0, 0, 0 };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>38 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>39&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; num/4; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vr = (__vector unsigned int) vec_perm(vsrc[i], vzero, vpatr);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>41&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vg = (__vector unsigned int) vec_perm(vsrc[i], vzero, vpatg);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vb = (__vector unsigned int) vec_perm(vsrc[i], vzero, vpatb);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>43 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfr = vec_ctf(vr, 0);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfg = vec_ctf(vg, 0);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>46&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfb = vec_ctf(vb, 0);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>47 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfy = vec_madd(vfr, vrconst, vfzero);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>49&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfy = vec_madd(vfg, vgconst, vfy);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfy = vec_madd(vfb, vbconst, vfy);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vy = vec_ctu(vfy, 0);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>53 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>54&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vpat = vec_cmpgt(vy, vmax);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vy = vec_sel(vy, vmax, vpat);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>56 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>57&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vdst[i] = (__vector unsigned char) vec_perm(vy, (__vector unsigned int)
  vzero, vpaty);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>58
  &nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>59 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>60&nbsp;&nbsp;&nbsp;&nbsp;
  return;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>61 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt'>&nbsp;</span></p>
  <p class=MsoNormal align=right style='text-align:right;layout-grid-mode:char;
  word-break:break-all'><span lang=EN-US><a href="src/practice3_4_q/">Click
  here for the source code for Practice Program (3-4).</a></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Strategy to Obtain the Answer</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>　</span><span
  lang=EN-US>Answering this question requires familiarity<span
  style='color:#333333'> with SPE programming. If necessary, go over this
  chapter again to review SPE program execution and SPE SIMD operations.</span></span></p>
  <p class=MsoNormal><span lang=EN-US style='color:#333333'>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US
  style='color:#333333'>The most important point, however, is how to transfer
  image data between the main memory and the LS for processing by the SPE
  program. Please pay special attention to the size and address alignment of
  the data to be transferred using DMA transfer. Note the maximum transferable
  data size. </span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>A model solution
is provided below, together with some relevant comments. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span style='font-family:
  "ＭＳ 明朝"'>【</span><span lang=EN-US>Solution Program (3-4)</span><span
  style='font-family:"ＭＳ 明朝"'>】</span><span lang=EN-US> (PPE Program)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>1 #include &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;2 #include
  &lt;stdlib.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;3 #include
  &lt;libspe2.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;4</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;5 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_src;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_dst;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;
  int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;pad[3];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>10 } grayscale_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>11</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>12 grayscale_params_t
  grayscale_params __attribute__((aligned(128)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>13</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>14 void rgb2y(unsigned char
  *src, unsigned char *dst, int num)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>15 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>16&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>17</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>18&nbsp;&nbsp;&nbsp;&nbsp;
  spe_context_ptr_t spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>19&nbsp;&nbsp;&nbsp;&nbsp;
  spe_program_handle_t *prog;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>20&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int entry;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>21&nbsp;&nbsp;&nbsp;&nbsp;
  spe_stop_info_t stop_info;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>22</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>23&nbsp;&nbsp;&nbsp;&nbsp;
  prog = spe_image_open(&quot;vec_grayscale_spe.elf&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>24&nbsp;&nbsp;&nbsp;&nbsp; if
  (!prog) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_open&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>26&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>27&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>28</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>29&nbsp;&nbsp;&nbsp;&nbsp;
  spe = spe_context_create(0, NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>30&nbsp;&nbsp;&nbsp;&nbsp;
  if (!spe) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>31&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>33&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>34</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>35&nbsp;&nbsp;&nbsp;&nbsp; ret
  = spe_program_load(spe, prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>36&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_program_load&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>39&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>40</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>41&nbsp;&nbsp;&nbsp;&nbsp;
  grayscale_params.ea_src = (unsigned long) src;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>42&nbsp;&nbsp;&nbsp;&nbsp;
  grayscale_params.ea_dst = (unsigned long) dst;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>43&nbsp;&nbsp;&nbsp;&nbsp;
  grayscale_params.num&nbsp;&nbsp;&nbsp; = num;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>44</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>45&nbsp;&nbsp;&nbsp;&nbsp;
  entry = SPE_DEFAULT_ENTRY;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>46&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_run(spe, &amp;entry, 0, &amp;grayscale_params, NULL,
  &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>47&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret &lt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_run&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>49&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>50&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>51</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>52&nbsp;&nbsp;&nbsp;&nbsp; ret
  = spe_context_destroy(spe);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>53&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>54&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_destroy&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>56&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>57</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>58&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_image_close(prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>59&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_close&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>61&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>62&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>63</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>64&nbsp;&nbsp;&nbsp;&nbsp;
  return;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>65 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=715
 style='width:536.4pt;border-collapse:collapse'>
 <tr>
  <td width=715 valign=top style='width:536.4pt;border:solid windowtext 1.0pt;
  background:#CCFFCC;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span style='font-family:
  "ＭＳ 明朝"'>【</span><span lang=EN-US>Solution Program (3-4)</span><span
  style='font-family:"ＭＳ 明朝"'>】</span><span lang=EN-US> (SPE Program)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 2 #include
  &lt;spu_intrinsics.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 3 #include
  &lt;spu_mfcio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 4 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 5 #define
  MAX_BUFSIZE (16 &lt;&lt; 10)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 6 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 7 unsigned char
  src_spe[MAX_BUFSIZE] __attribute__((aligned(128)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 8 unsigned char
  dst_spe[MAX_BUFSIZE] __attribute__((aligned(128)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 9 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;10 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_src;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_dst;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp;
  int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pad[3];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;15 }
  grayscale_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;16 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;17 grayscale_params_t
  grayscale_params __attribute__((aligned(128)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;18 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;19 void
  rgb2y(unsigned char *src, unsigned char *dst, int num)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;20 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;22 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;23&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char *vsrc = (__vector unsigned char *) src;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;24&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char *vdst = (__vector unsigned char *) dst;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;25 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;26&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned int vr, vg, vb, vy, vpat;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;27&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vfr, vfg, vfb, vfy;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;28 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;29&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vrconst = spu_splats(0.29891f);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vgconst = spu_splats(0.58661f);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;31&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vbconst = spu_splats(0.11448f);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;32&nbsp;&nbsp;&nbsp;&nbsp;
  __vector float vfzero&nbsp; = spu_splats(0.0f);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned int vmax = spu_splats((unsigned int) 255);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;34 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;35&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vpatr = (__vector unsigned char) { 0x10, 0x10, 0x10,
  0x00,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;36&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x04,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x08,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x10, 0x10, 0x10, 0x0c };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;39&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vpatg = (__vector unsigned char) { 0x10, 0x10, 0x10,
  0x01,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x05,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;41&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x10,
  0x10, 0x10, 0x09,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x0d };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;43&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vpatb = (__vector unsigned char) { 0x10, 0x10, 0x10,
  0x02,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x10,
  0x10, 0x10, 0x06,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x0a,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;46&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x10, 0x10, 0x10, 0x0e };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;47&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vpaty = (__vector unsigned char) { 0x03, 0x03, 0x03,
  0x10,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x07, 0x07, 0x07, 0x10,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;49&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x0b, 0x0b, 0x0b, 0x10,</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  0x0f, 0x0f, 0x0f, 0x10 };</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;51&nbsp;&nbsp;&nbsp;&nbsp;
  __vector unsigned char vzero = spu_splats((unsigned char) 0);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;52 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;53&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; num/4; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;54&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vr = (__vector unsigned int) spu_shuffle(vsrc[i], vzero, vpatr);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vg = (__vector unsigned int) spu_shuffle(vsrc[i], vzero, vpatg);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;56&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vb = (__vector unsigned int) spu_shuffle(vsrc[i], vzero, vpatb);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;57 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;58&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfr = spu_convtf(vr, 0);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;59&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfg = spu_convtf(vg, 0);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfb = spu_convtf(vb, 0);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;61 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;62&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfy = spu_madd(vfr, vrconst, vfzero);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;63&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfy = spu_madd(vfg, vgconst, vfy);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vfy = spu_madd(vfb, vbconst, vfy);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;65 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;66&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vy = spu_convtu(vfy, 0);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;67 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;68&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vpat = spu_cmpgt(vy, vmax);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;69&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vy = spu_sel(vy, vmax, vpat);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;70 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  vdst[i] = (__vector unsigned char) spu_shuffle(vy, (__vector unsigned int)
  vzero, vpaty);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;72&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;73 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;74&nbsp;&nbsp;&nbsp;&nbsp;
  return;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;75 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;76 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;77 int main(unsigned
  long long spe, unsigned long long argp, unsigned long long envp)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;78 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;79&nbsp;&nbsp;&nbsp;&nbsp;
  int tag = 1;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;80 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;81&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long ea_src, ea_dst;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;82&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int remain, num;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;83 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;84&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 1 : GET input/output parameters */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;85&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(&amp;grayscale_params, mfc_ea2h(argp), mfc_ea2l(argp),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  sizeof(grayscale_params_t), tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;87&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;88&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;89 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;90&nbsp;&nbsp;&nbsp;&nbsp;
  ea_src = grayscale_params.ea_src;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;91&nbsp;&nbsp;&nbsp;&nbsp;
  ea_dst = grayscale_params.ea_dst;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;92&nbsp;&nbsp;&nbsp;&nbsp;
  remain = grayscale_params.num;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;93 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;94&nbsp;&nbsp;&nbsp;&nbsp;
  /* main loop */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;95&nbsp;&nbsp;&nbsp;&nbsp;
  while (remain &gt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (remain &gt; MAX_BUFSIZE/4) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;97&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  num = MAX_BUFSIZE/4;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;98&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  } else {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;99&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  num = remain;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>100&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>101 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 2 : GET input data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>103&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(src_spe, mfc_ea2h(ea_src), mfc_ea2l(ea_src),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>104&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  num * 4, tag, MFC_GET_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>105&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>106&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>107 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>108&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* convert to grayscale data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>109&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  rgb2y(src_spe, dst_spe, num);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>110 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>111&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* DMA Transfer 3 : PUT output data */</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>112&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcdma64(dst_spe, mfc_ea2h(ea_dst), mfc_ea2l(ea_dst),</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>113&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num * 4,
  tag, MFC_PUT_CMD);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>114&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  spu_writech(MFC_WrTagMask, 1 &lt;&lt; tag);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>115&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  spu_mfcstat(MFC_TAG_UPDATE_ALL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>116 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>117&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  remain -= num;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>118&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ea_src += num * 4;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>119&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ea_dst += num * 4;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>120&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>121 </span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>122&nbsp;&nbsp;&nbsp;&nbsp;
  return 0;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>123 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><a href="src/practice3_4_a/">Click here for
the source code for Solution Program (3-4).</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Program Description</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Two major
  considerations engendered by this question are how to transfer the <b>rgb2y()
  </b>function from the PPE program to the SPE program and how to transfer
  large data to the SPE program using DMA transfer. </span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Execution of
  the SPE program from the PPE program, including the creation and destruction
  of SPE contexts, can be performed in the same way as for previous questions.
  With regard to the input/output parameters required by the SPE program, set
  them in the parameter set <i>grayscale_params</i> and pass the effective
  address of this parameter set to the SPE program.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Processing of
  the <b>rgb2y()</b> function is executed by the SPE program. For this reason,
  it is necessary to replace the PPE’s VMX intrinsics of this function with the
  equivalent SPU SIMD intrinsics.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The SPE
  program obtains color image data from the main memory, converts it into
  grayscale data and returns the converted data to the main memory. This
  process of conversion is repeated as many times as necessary when the image
  data size exceeds the memory size of the LS and/or the maximum size of data
  transferable in a single DMA transfer.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The memory
  size of the LS is 256 Kbytes. This means that input data greater than 256
  Kbytes cannot be converted at one time. Similarly, DMA transfer must be
  repeated when the maximum allowable limit of 16 Kbytes is exceeded. In the
  above solution program, therefore, the </span><span lang=EN-US
  style='font-family:"Courier New"'>while</span><span lang=EN-US> loop
  statement is used to divide input data into 16 Kbyte units. </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:8.9pt'><span lang=EN-US>A brief
  description of the source code follows.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(PPE Program)</span></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 5</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>10</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    define the data type <i>grayscale_params_t</i> of the parameter set to be
    passed to the SPE program. By <i>pad[3]</i>, data is padded into 32 bytes
    for DMA transfer, which requires the data size to be a multiple of 16
    bytes.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 41</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>43</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    set the parameters (effective addresses of scalar arrays <i>src</i> and <i>dst</i>,
    plus the number of pixels <i>num</i>) to be passed to the SPE program.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 46</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to specify
    the effective address of the parameter <i>grayscale_params</i> to be passed
    to the SPE program as the fourth argument of the <b>spe_context_run()</b>
    function.</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(SPE Program)</span></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 5</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to define
    the size of input/output data buffers on the LS. In this solution program,
    it is defined to be 16 Kbytes in accordance with the size of data that can
    be transferred by DMA transfer.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 7</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>8</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    define scalar arrays <i>src_spe </i>and <i>dst_spe</i> that function as the
    input/output buffers of the LS .</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 19</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>75</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    define how to execute the <b>rgb2y()</b> function that undertakes grayscale
    conversion. VMX intrinsics contained in Practice Question (3-4) have been
    replaced with the equivalent SPU SIMD intrinsics.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 85</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>88</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    transfer the parameter set <i>grayscale_params</i> from the main memory to
    the LS by DMA transfer (GET).</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 90</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>92</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    copy information about the effective addresses and data size of the main
    memory’s input/output buffers from the parameter set <i>grayscale_params</i>
    for use in DMA transfer (GET) of data to be passed to the <b>rgb2y()</b>
    function.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 96</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>100</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    adjust the data size pursuant to the DMA transfer size constraint. </span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 103</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>106</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to obtain
    input data from the main memory by DMA transfer (GET).</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Line 109</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    execute the <b>rgb2y()</b> function to perform grayscale conversion, as
    well as to store the converted data in the output buffer. </span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 112</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>115</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    transfer grayscale data to the main memory using DMA transfer (PUT).</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 117</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>119</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    update the parameters (effective addresses and data size of input/output
    buffers) as processing progresses.</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>　</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Toc148010411"></a><a
name="_Toc188185548"></a><a name="_Toc154400422"></a><a name="_Ref151233639"></a><a
name="_Ref151233633"></a><a name="_Toc148010754"></a><span lang=EN-US>3.10</span><span
lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Exercise (3-5): Grayscale Conversion Program (for
Multiple SPEs)</span><span lang=EN-US> </span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>This exercise
can be used as a comprehensive review of what we’ve learned inChapter 3.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Question</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Rewrite the
  grayscale conversion program we worked on in Exercise (3-4) so that it can be
  run on multiple SPEs. </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Strategy to Obtain the Answer</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The point to
  consider with this question is how to partition data for parallel processing
  by four SPEs.&nbsp; </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Like the
  programs in Exercise (2-4) and Exercise (3-4), the number of pixels of the
  input data is set to a multiple of 4, i.e., the size of data to be processed
  is a multiple of 16 bytes. Although this has caused no problems during
  previous exercises in performing DMA transfer and SIMD operations, the
  situation is a bit different with the program we are now going to work on. It
  is important to give consideration to the data size, taking into account the
  need to partition data for processing by multiple SPEs. </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Note that
  there is no need to rewrite the SPE program.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  background:#CCFFFF;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span style='font-family:
  "ＭＳ 明朝"'>【</span><span lang=EN-US>Solution Program (3-5)</span><span
  style='font-family:"ＭＳ 明朝"'>】</span><span lang=EN-US>(PPE Program)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 1 #include
  &lt;stdio.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 2 #include
  &lt;stdlib.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 3 #include
  &lt;libspe2.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 4 #include
  &lt;pthread.h&gt;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 5</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 6 #define NUM_SPE 4</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 7</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 8 #define
  ALIGN4_UP(x) ((x) &amp; 0x3) ? ((((x) &gt;&gt; 2) + 0x1) &lt;&lt; 2) : (x)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp; 9</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;10 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_src;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned long long&nbsp; ea_dst;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp;
  int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pad[3];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;15 }
  grayscale_params_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;16</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;17 grayscale_params_t
  grayscale_params[NUM_SPE] __attribute__((aligned(128)));</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;18</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;19 typedef struct {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;
  spe_context_ptr_t&nbsp;&nbsp; spe;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;
  grayscale_params_t&nbsp; *grayscale_params;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;22 } thread_arg_t;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;23</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;24 void
  *run_grayscale_spe(void *thread_arg)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;25 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;26&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;27&nbsp;&nbsp;&nbsp;&nbsp;
  thread_arg_t *arg = (thread_arg_t *) thread_arg;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;28&nbsp;&nbsp;&nbsp;&nbsp;
  unsigned int entry;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;29&nbsp;&nbsp;&nbsp;&nbsp;
  spe_stop_info_t stop_info;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;30</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;31&nbsp;&nbsp;&nbsp;&nbsp;
  entry = SPE_DEFAULT_ENTRY;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;32&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_context_run(arg-&gt;spe, &amp;entry, 0, arg-&gt;grayscale_params,
  NULL, &amp;stop_info);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret &lt; 0) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;34&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_run&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  return NULL;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;36&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;37</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;38&nbsp;&nbsp;&nbsp;&nbsp;
  return NULL;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;39 }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;40</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;41 void
  rgb2y(unsigned char *src, unsigned char *dst, int num)</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;42 {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;43&nbsp;&nbsp;&nbsp;&nbsp;
  int i;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;44&nbsp;&nbsp;&nbsp;&nbsp;
  int ret;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;45&nbsp;&nbsp;&nbsp;&nbsp;
  int remain;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;46&nbsp;&nbsp;&nbsp;&nbsp;
  int chunk;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;47</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;48&nbsp;&nbsp;&nbsp;&nbsp;
  spe_program_handle_t *prog;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;49
  &nbsp;&nbsp;&nbsp;&nbsp;spe_context_ptr_t spe[NUM_SPE];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;
  pthread_t thread[NUM_SPE];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;51&nbsp;&nbsp;&nbsp;&nbsp;
  thread_arg_t arg[NUM_SPE];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;52</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;53&nbsp;&nbsp;&nbsp;&nbsp;
  prog = spe_image_open(&quot;vec_grayscale_spe.elf&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;54&nbsp;&nbsp;&nbsp;&nbsp;
  if (!prog) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_open&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;56&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;57&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;58</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;59&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  spe[i] = spe_context_create(0, NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;61&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (!spe[i]) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;62&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;63&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;65</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;66&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_program_load(spe[i], prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;67&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;68&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_program_load&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;69&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;71&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;72</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;73&nbsp;&nbsp;&nbsp;&nbsp;
  remain = num;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;74&nbsp;&nbsp;&nbsp;&nbsp;
  chunk = num/NUM_SPE;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;75&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;76&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  grayscale_params[i].ea_src = (unsigned long) src;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;77&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  grayscale_params[i].ea_dst = (unsigned long) dst;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;78&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (remain &gt; chunk) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;79&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  grayscale_params[i].num = ALIGN4_UP(chunk);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  } else {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;81&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  grayscale_params[i].num = ALIGN4_UP(remain);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;82&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;83</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;84&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  arg[i].spe = spe[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;85&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  arg[i].grayscale_params = &amp;grayscale_params[i];</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;86</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;87&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ret = pthread_create(&amp;thread[i], NULL, run_grayscale_spe, &amp;arg[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;88&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;89&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;pthread_create&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;91&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;92</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;93&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  remain -= chunk;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;94&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  src&nbsp;&nbsp;&nbsp; += (chunk * 4);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;95&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  dst&nbsp;&nbsp;&nbsp; += (chunk * 4);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;97</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;98&nbsp;&nbsp;&nbsp;&nbsp;
  for (i = 0; i &lt; NUM_SPE; i++) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>&nbsp;99&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  pthread_join(thread[i], NULL);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;ret = spe_context_destroy(spe[i]);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_context_destroy&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>103&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>104&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>105&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>106</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>107&nbsp;&nbsp;&nbsp;&nbsp;
  ret = spe_image_close(prog);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>108&nbsp;&nbsp;&nbsp;&nbsp;
  if (ret) {</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>109&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  perror(&quot;spe_image_close&quot;);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>110&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  exit(1);</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>111&nbsp;&nbsp;&nbsp;&nbsp;
  }</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>112</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>113&nbsp;&nbsp;&nbsp;&nbsp;
  return;</span></p>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US
  style='font-size:9.0pt;font-family:"Courier New"'>114 }</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US><a
  href="src/practice3_5_a/">Click here for the source code for Solution Program
  (3-5).</a></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=693 valign=top style='width:520.1pt;border:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>【</span><span
  lang=EN-US>Program Description</span><span style='font-family:"ＭＳ 明朝"'>】</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>The SPE program
  created in Exercise (3-4) can be used as is. </span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Image data
  must be divided into quarters for grayscale conversion by the four SPEs
  operating in parallel. </span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In doing so,
  be sure to adjust the data size carefully in advance, paying attention to the
  following two restrictions on DMA transfer. </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='margin-left:39.0pt;text-indent:-39.0pt'><span
  lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:
  "Times New Roman"'>&nbsp;&nbsp; </span><span lang=EN-US>The size of data to
  be transferred must be a multiple of 16 bytes.</span></p>
  <p class=MsoNormal style='margin-left:39.0pt;text-indent:-39.0pt'><span
  lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:
  "Times New Roman"'>&nbsp;&nbsp; </span><span lang=EN-US>The initial address
  of the area of the main memory used for DMA transfer, as well as the initial
  address of the area of the LS used for the same purpose, must be aligned to
  16-byte boundaries.&nbsp; </span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>For example,
  if the input data is 28 pixels, the number of pixels of data to be
  distributed to each SPE becomes 7 pixels (or 28 bytes in terms of data size).
  Since this amount of data cannot be transferred by one DMA transfer, the <b>ALIGN4_UP()</b>
  macro is created and used with this program to make the pixel number per SPE
  a multiple of 4. This, in turn, sets the transfer size to a multiple of 16
  bytes.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>If the input
  data to the four SPEs are appropriately sized and partitioned, you are ready
  to create the thread to each SPE and execute the SPE program. The four SPEs
  operate in parallel to perform grayscale conversion and return the converted
  data to the main memory.</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Last of all,
  the PPE program integrates the data converted by the SPEs and outputs it to a
  file..</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>A brief
  explanation of the source code follows.</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>(PPE Program)</span></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 19</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>22</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    define the data type <i>grayscale_params_t</i> of the parameter set to be
    passed to the SPE program. By <i>pad[3]</i>, data is padded into 32 bytes
    for DMA transfer, which requires the data size to be a multiple of 16
    bytes.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 24</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>39</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>The <b>run_grayscale_spe()</b>
    function is used as the thread start function. It is executed on each
    thread to enable grayscale conversion by the SPE program, using the
    parameter set passed to its argument. </span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 59</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>71</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to
    create the SPE context for each SPE, as well as to load the SPE program to
    each SPE’s LS.</span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 73</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>96</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Used to partition
    color image data for distribution to SPEs, as well as to create new threads
    using the <b>pthread_create()</b> function. The initial address of each
    partitioned image data must be aligned to 16-byte boundaries to make DMA
    transfer occur normally. For the same reason, the number of pixels must be
    pre-adjusted to a multiple of 4. </span></p>
    </td>
   </tr>
   <tr>
    <td width=144 valign=top style='width:108.0pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Lines 98</span><span
    style='font-family:"ＭＳ 明朝"'>〜</span><span lang=EN-US>105</span></p>
    </td>
    <td width=534 valign=top style='width:400.55pt;padding:0mm 5.4pt 0mm 5.4pt'>
    <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Using the
    <b>pthread_join()</b> function, used to wait for the SPE program to
    terminate. </span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Grayscale
  conversion programs explained in Exercises (2-4), (3-4) and (3-5) have been
  designed to give you sufficient experience with rewriting conventional
  programs into programs that run at high speed on the Cell. Common to all
  these programs, rewriting is performed in the following three steps.</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>&nbsp; </span></p>
  <p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
  lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:
  "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=EN-US>Conversion
  from scalar to SIMD operations <b><span style='color:red'>(Vectorization)</span></b></span></p>
  <p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
  lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:
  "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=EN-US>Translocation
  of computation from the PPE program to the SPE program<b><span
  style='color:red'>(SPE Offloading)</span></b></span></p>
  <p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
  lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:
  "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=EN-US>Data
  partitioning for multi-SPE processing <b><span style='color:red'>(Multi-SPE
  Parallelization</span></b>)</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Now that you
  are confident in the knowledge you have gained about the basic processes of
  Cell programming, why not try porting your programs onto the Cell?</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<h2 style='margin-left:55.35pt;text-indent:-55.35pt'><a name="_Toc154400423"></a><a
name="_Toc188185549"></a><span lang=EN-US>3.11</span><span lang=EN-US
style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US>Chapter Summary</span></h2>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In summary, this
chapter has covered the following five aspects of SPE programming.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(1)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>SPE Programming Overview </span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(2)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Simple SPE Program</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(3)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Transporting Data by DMA Transfer</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(4)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>SIMD Programming on SPE</span></p>

<p class=MsoNormal style='margin-left:57.0pt;text-indent:-57.0pt'><span
lang=EN-US>(5)</span><span lang=EN-US style='font-size:7.0pt;font-family:"Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US>Parallel Programming Using Multiple SPEs</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Major Points of
Discussion in Section 3.1: SPE Programming Overview</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Procedures for
running the SPE program have been explained in this section, together with the
library used in SPE programming. In the most basic programming model described
here, the main program is executed on the PPE and the sub-program is executed
on the SPE. SPE program execution is controlled by using a library called
libspe2. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Major Points of
Discussion in Section 3.2: Simple SPE Program</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Taking the hello
world program as an example, SPE programming has been explained in more detail,
with the focus on the SPE program execution process using libspe 2 and the
usage of some basic libspe2&nbsp; APIs.&nbsp; </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Major Points of
Discussion in Section 3.3: Transporting Data by DMA Transfer</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>Data transfer between
the PPE program and the SPE program has been covered in this section. The SPE
capitalizes on DMA transfer to transfer data to and from the main memory since
it cannot directly access any memories except its own local memory. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>　</span><span lang=EN-US>Major
Points of Discussion in Section 3.4: SIMD Programming on SPE</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In comparison
with SIMD operations using VMX instructions, SIMD operations on the SPE have
been explained in this section. The SPE program uses SPU SIMD instructions that
can be used in the same manner as VMX instructions.&nbsp; </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>　</span><span lang=EN-US>Major
Points of Discussion in Section 3.5: Parallel Programming Using Multiple SPEs</span></p>

<p class=MsoNormal style='text-indent:10.5pt'><span lang=EN-US>In this section,
we have learned how to run a program on multiple SPEs. Multi-SPE
parallelization is enabled by the use of a thread library that allows creation
of threads corresponding to the number of SPEs used. </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>　</span><span lang=EN-US>As
a whole, each section of this chapter has a specific learning theme that makes
it easy and quick to acquire the knowledge and programming skills necessary for
SPE programming.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"ＭＳ 明朝"'>　</span><span lang=EN-US>Table
3.5 provides a list of reference documents introduced in this chapter, which
you will find very useful if you want to study more about SPE programming.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoCaption align=center style='text-align:center'><span lang=EN-US>Table
3.5: Reference Documents</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=271 valign=top style='width:203.4pt;border:solid windowtext 1.0pt;
  background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><span lang=EN-US>Document</span></p>
  </td>
  <td width=422 valign=top style='width:316.7pt;border:solid windowtext 1.0pt;
  border-left:none;background:#FFFF99;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;layout-grid-mode:
  char'><span lang=EN-US>Description</span></p>
  </td>
 </tr>
 <tr>
  <td width=271 valign=top style='width:203.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>SPE Runtime Management Library Version 2.0</span></p>
  </td>
  <td width=422 valign=top style='width:316.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Describes
  the API for libspe2.</span></p>
  </td>
 </tr>
 <tr>
  <td width=271 valign=top style='width:203.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>SPUFS: The Cell Synergistic Processing Unit as a virtual file
  system</span></p>
  </td>
  <td width=422 valign=top style='width:316.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Describes
  the Linux kernel interface used by libspe2.</span></p>
  </td>
 </tr>
 <tr>
  <td width=271 valign=top style='width:203.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Cell Broadband Engine Programming Tutorial</span></p>
  </td>
  <td width=422 valign=top style='width:316.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Cell programming
  tutorial published by IBM.</span></p>
  </td>
 </tr>
 <tr>
  <td width=271 valign=top style='width:203.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>Cell Broadband Engine Architecture</span></p>
  </td>
  <td width=422 valign=top style='width:316.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Describes
  the Cell Broadband Engine Architecture.</span></p>
  </td>
 </tr>
 <tr>
  <td width=271 valign=top style='width:203.4pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><span
  lang=EN-US>C/C++ Language Extensions for Cell Broadband Engine Architecture</span></p>
  </td>
  <td width=422 valign=top style='width:316.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0mm 5.4pt 0mm 5.4pt'>
  <p class=MsoNormal style='layout-grid-mode:char'><span lang=EN-US>Describes
  API extensions for the Cell using C/C++.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

</body>

</html>
